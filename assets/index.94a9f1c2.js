var Je=Object.defineProperty;var Qe=(t,e,n)=>e in t?Je(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var y=(t,e,n)=>(Qe(t,typeof e!="symbol"?e+"":e,n),n),ye=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var w=(t,e,n)=>(ye(t,e,"read from private field"),n?n.call(t):e.get(t)),B=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},S=(t,e,n,o)=>(ye(t,e,"write to private field"),o?o.call(t,n):e.set(t,n),n);import{K as Pe,r as U,f as et,S as F,w as q,o as tt,a as nt,B as H,m as R,b as ue,s as te,c as I,d as ne,t as we,e as v,g as O,h as E,i as Y,j as he,p as ot,k as oe,l as pe,I as rt,n as it,q as st,u as at,v as ct,x as lt,y as dt,z as ut,A as ht,N as pt,C as ft,D as gt,E as mt,F as bt,G as Ce,H as yt,J as wt,L as Ct,M as xt}from"./vendor.e007f03c.js";const vt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}};vt();function J(t=0,e=0){const n=document.createElement("canvas");return n.width=t,n.height=e,n}function xe(t,e){return Array.from({length:e-t}).map((n,o)=>t+o)}function $t(t){let e=[];for(const n of t)n.length>e.length&&(e=n);return e}const kt=["1","2","3","4","5","6","7","8","9"],St=["Andale Mono, Menlo","Arial","Cambria, Gill Sans","Comic Sans MS, Chalkboard SE","Courier","Impact, Avenir Next Condensed","Times New Roman","Trebuchet MS","Verdana"],Ut=["bold",""];async function Gt(t,e,n,o,r){const i=[n,n-1,n-2,n-3];let s=[];await r({step:"Generating Font Combinations"});for(const d of kt)for(const f of St)for(const p of Ut)for(const b of i){const C=J(t,e),g=C.getContext("2d");g.fillStyle="white",g.fillRect(0,0,t,e),g.fillStyle="black";const M=Mt(g,p,f,b);g.font=`${p} ${M}px ${f}`;const A=g.measureText(d),le=A.actualBoundingBoxLeft+A.actualBoundingBoxRight,de=A.actualBoundingBoxLeft+Math.round((t-le)/2),W=Math.round((e-b)/2);g.fillText(d,de,e-W),s.push([C,parseInt(d,10)])}await r({step:"Generating Training Set"}),s=s.flatMap(([d,f])=>[[d,f],[re(d,1,0),f],[re(d,-1,0),f],[re(d,0,1),f],[re(d,0,-1),f]]),await r({step:"Training KNN Model"});const a=s.map(d=>d[1]),c=s.map(d=>ve(d[0])),h=new Pe(c,a);await r({step:"Running KNN Model"});const u=o.map(ve);return h.predict(u)}function re(t,e,n){const r=t.getContext("2d").getImageData(0,0,t.width,t.height),i=J(t.width,t.height),s=i.getContext("2d");return s.fillStyle="white",s.fillRect(0,0,t.width,t.height),s.putImageData(r,e,n),i}function ve(t){const n=t.getContext("2d").getImageData(0,0,t.width,t.height),o=[];for(let r=0;r<n.data.length;r+=4)o.push(n.data[r]);return o}function Mt(t,e,n,o){let r=o,i=0;for(;i<o;)t.font=`${e} ${r}px ${n}`,i=t.measureText("8").actualBoundingBoxAscent,i<o&&r++;return r}function $e(t){let e;return typeof t=="object"?(e=t[0],typeof e=="object"?[t.length,e.length]:[t.length]):[]}function ke(t,e,n,o){if(n===e.length-1)return o(t);let r;const i=e[n],s=Array(i);for(r=i-1;r>=0;r--)s[r]=ke(t[r],e,n+1,o);return s}function At(t){const e=t.length;let n;const o=Array(e);for(n=e-1;n!==-1;--n)o[n]=t[n];return o}function It(t){if(typeof t!="object")return t;const e=At,n=$e(t);return ke(t,n,0,e)}function _t(t){let e,n,o;const r=t.length,i=Array(r);let s;for(e=r-1;e>=0;e--){for(s=Array(r),n=e+2,o=r-1;o>=n;o-=2)s[o]=0,s[o-1]=0;for(o>e&&(s[o]=0),s[e]=t[e],o=e-1;o>=1;o-=2)s[o]=0,s[o-1]=0;o===0&&(s[0]=0),i[e]=s}return i}function Se(t,e,n){typeof n=="undefined"&&(n=0);const o=t[n],r=Array(o);let i;if(n===t.length-1){for(i=o-2;i>=0;i-=2)r[i+1]=e,r[i]=e;return i===-1&&(r[0]=e),r}for(i=o-1;i>=0;i--)r[i]=Se(t,e,n+1);return r}function Bt(t){return _t(Se([t],1))}function Rt(t){const e=$e(t),n=Math.abs,o=e[0],r=e[1],i=It(t);let s,a;const c=Bt(o);let h,u,d,f,p,b;for(f=0;f<r;++f){let C=-1,g=-1;for(d=f;d!==o;++d)p=n(i[d][f]),p>g&&(C=d,g=p);for(a=i[C],i[C]=i[f],i[f]=a,u=c[C],c[C]=c[f],c[f]=u,b=a[f],p=f;p!==r;++p)a[p]/=b;for(p=r-1;p!==-1;--p)u[p]/=b;for(d=o-1;d!==-1;--d)if(d!==f){for(s=i[d],h=c[d],b=s[f],p=f+1;p!==r;++p)s[p]-=a[p]*b;for(p=r-1;p>0;--p)h[p]-=u[p]*b,--p,h[p]-=u[p]*b;p===0&&(h[0]-=u[0]*b)}}return c}function Ue(t,e){let n,o,r,i,s,a,c;const h=t.length,u=e.length,d=e[0].length,f=Array(h);for(n=h-1;n>=0;n--){for(i=Array(d),s=t[n],r=d-1;r>=0;r--){for(a=s[u-1]*e[u-1][r],o=u-2;o>=1;o-=2)c=o-1,a+=s[o]*e[o][r]+s[c]*e[c][r];o===0&&(a+=s[0]*e[0][r]),i[r]=a}f[n]=i}return f}function Lt(t,e){const n=t.length;let o;const r=Array(n);for(o=n-1;o>=0;o--)r[o]=Nt(t[o],e);return r}function Nt(t,e){let n;const o=t.length;let r,i=t[o-1]*e[o-1];for(n=o-2;n>=1;n-=2)r=n-1,i+=t[n]*e[n]+t[r]*e[r];return n===0&&(i+=t[0]*e[0]),i}function Ge(t){let e,n;const o=t.length,r=t[0].length,i=Array(r);let s,a,c;for(n=0;n<r;n++)i[n]=Array(o);for(e=o-1;e>=1;e-=2){for(a=t[e],s=t[e-1],n=r-1;n>=1;--n)c=i[n],c[e]=a[n],c[e-1]=s[n],--n,c=i[n],c[e]=a[n],c[e-1]=s[n];n===0&&(c=i[0],c[e]=a[0],c[e-1]=s[0])}if(e===0){for(s=t[0],n=r-1;n>=1;--n)i[n][0]=s[n],--n,i[n][0]=s[n];n===0&&(i[0][0]=s[0])}return i}function Tt(t){return Math.round(t*1e10)/1e10}function Ot(t,e,n){if(n){const g=e;e=t,t=g}const o=[t[0],t[1],1,0,0,0,-1*e[0]*t[0],-1*e[0]*t[1]],r=[0,0,0,t[0],t[1],1,-1*e[1]*t[0],-1*e[1]*t[1]],i=[t[2],t[3],1,0,0,0,-1*e[2]*t[2],-1*e[2]*t[3]],s=[0,0,0,t[2],t[3],1,-1*e[3]*t[2],-1*e[3]*t[3]],a=[t[4],t[5],1,0,0,0,-1*e[4]*t[4],-1*e[4]*t[5]],c=[0,0,0,t[4],t[5],1,-1*e[5]*t[4],-1*e[5]*t[5]],h=[t[6],t[7],1,0,0,0,-1*e[6]*t[6],-1*e[6]*t[7]],u=[0,0,0,t[6],t[7],1,-1*e[7]*t[6],-1*e[7]*t[7]],d=[o,r,i,s,a,c,h,u],f=e;let p;try{p=Rt(Ue(Ge(d),d))}catch{return[1,0,0,0,1,0,0,0]}const b=Ue(p,Ge(d)),C=Lt(b,f);for(let g=0;g<C.length;g++)C[g]=Tt(C[g]);return C[8]=1,C}function Et(t,e,n){const[o,r,i,s,a,c,h,u]=t,d=(c-n)/(u*n-a+h*n-s),f=(e*u*d+e-r*d-i)/(o-e*h),p=(i-e)/(h*e-o+u*e-r),b=(n*h*p+n-s*p-c)/(a-n*u);return[f,b]}function Me(t,e=255){const{w:n}=t,o=[-n-1,-n,1-n,-1],r=[],i=new Set;for(const s of t.pixels)if(s.r===e){let a={members:[s],mergeWith(c){const[h,u]=c.members.length>this.members.length?[c,this]:[this,c];for(const d of u.members)h.members.push(d),r[d.i]=h;return i.delete(u),h}};i.add(a),r[s.i]=a;for(const c of o){const h=r[s.i+c];h&&h!==a&&(a=a.mergeWith(h))}}return Array.from(i).map(s=>s.members)}function Dt(t){let e=t[0],n=t[0],o=t[0],r=t[0];for(const i of t)e=e.x*e.y<i.x*i.y?e:i,n=n.rx*n.y<i.rx*i.y?n:i,o=o.x*o.ry<i.x*i.ry?o:i,r=r.rx*r.ry<i.rx*i.ry?r:i;return[e,n,r,o]}function Ae(t,e){let n=999999,o=0,r=999999,i=0;for(const s of e)n=Math.min(n,s.x),o=Math.max(o,s.x),r=Math.min(r,s.y),i=Math.max(i,s.y);return[t.pixel(n,r),t.pixel(o,r),t.pixel(o,i),t.pixel(n,i)]}const D=Symbol();var K,X,_,j,Z;const ce=class{constructor(e,n,o){B(this,K,void 0);B(this,X,void 0);B(this,_,void 0);B(this,j,void 0);B(this,Z,void 0);y(this,"w");y(this,"h");S(this,K,e),S(this,X,e(n,o)),S(this,_,w(this,X).getContext("2d")),S(this,j,w(this,_).getImageData(0,0,n,o)),this.w=n,this.h=o,S(this,Z,xe(0,this.w*this.h).map(r=>new jt(this,r)))}get canvas(){return w(this,_).putImageData(w(this,j),0,0),w(this,X)}drawImage(e,n=0,o=0){w(this,_).drawImage(e,n,o),S(this,j,w(this,_).getImageData(0,0,this.w,this.h))}get pixels(){return w(this,Z)}pixel(e,n){return w(this,Z)[n*this.w+e]}get[D](){return w(this,j).data}clone(){const e=new ce(w(this,K),this.w,this.h);return e.drawImage(this.canvas),e}crop(e,n){const{x:o,y:r}=e,i=n.x-o+1,s=n.y-r+1,a=new ce(w(this,K),i,s);return a.drawImage(this.canvas,-o,-r),a}fill(e){w(this,_).fillStyle=e,w(this,_).fillRect(0,0,this.w,this.h),S(this,j,w(this,_).getImageData(0,0,this.w,this.h))}};let ie=ce;K=new WeakMap,X=new WeakMap,_=new WeakMap,j=new WeakMap,Z=new WeakMap;class jt{constructor(e,n){y(this,"easyCanvas");y(this,"i");this.easyCanvas=e,this.i=n}get x(){return this.i%this.easyCanvas.w}get rx(){return this.easyCanvas.w-this.x}get y(){return Math.floor(this.i/this.easyCanvas.w)}get ry(){return this.easyCanvas.h-this.y}get xy(){return[this.x,this.y]}get r(){return this.easyCanvas[D][this.i*4]}get g(){return this.easyCanvas[D][this.i*4+1]}get b(){return this.easyCanvas[D][this.i*4+2]}setRGB(e){const n=this.easyCanvas[D],o=this.i*4;typeof e=="number"?n[o]=n[o+1]=n[o+2]=e:(n[o]=e[0],n[o+1]=e[1],n[o+2]=e[2])}get rgb(){const e=this.easyCanvas[D],n=this.i*4;return[e[n],e[n+1],e[n+2]]}set a(e){const n=this.easyCanvas[D],o=this.i*4;n[o+3]=e}get a(){const e=this.easyCanvas[D],n=this.i*4;return e[n+3]}}function zt(t,e,n,o){const r=n-e.w,i=o-e.h,s=new ie(t,n,o);return s.fill("white"),s.drawImage(e.canvas,Math.round(r/2),Math.round(i/2)),s}function Ie(t){for(const e of t.pixels){const n=.3*e.r+.3*e.g+.4*e.b;e.setRGB(n)}return t}function Ft(t){for(const e of t.pixels){const n=e.r<126?0:255;e.setRGB(n)}return t}function Vt(t,e){const n=e.map(o=>t.pixels[o]);for(const o of t.pixels)o.a=0;for(const o of n)o.a=255;for(const o of t.pixels)o.a===0&&(o.a=255,o.setRGB(255));return t}function Wt(t){return t<.5?4*t*t*t:1-(-2*t+2)**3/2}function Ht(t){let e=255;for(const o of t.pixels)e=Math.min(e,o.r);const n=255-e;for(const o of t.pixels){const r=o.r-e,i=Wt(1-r/n);o.setRGB(o.r-Math.round(e*i))}return t}function Yt(t){const e={};function n(o,r){e[o]=e[o]||[],e[o].push(r)}for(const o of t.pixels)if(o.r<255){const r=t.pixels[o.i-t.w],i=t.pixels[o.i+t.w],s=t.pixels[o.i-1],a=t.pixels[o.i+1];r&&n(r.i,o.r),i&&n(i.i,o.r),s&&n(s.i,o.r),a&&n(a.i,o.r)}for(const o in e){const r=Math.min(...e[o]);t.pixels[o].setRGB(r)}return t}const Kt=10;function Xt(t,e){const n=Math.floor(e/2)*t;return[Math.floor(t*.25)+n,Math.floor(t*.75)+n]}async function Zt(t,e){await e({step:"Preparing image"});const n=t.width,o=t.height,r=new ie(J,n,o);r.fill("white"),r.drawImage(t);const i=r.clone();await e({step:"Applying Filters"}),Ft(Ie(i)),await e({step:"Finding Connected Pixels"});const s=Me(i,0);await e({step:"Finding Grid"});const a=xe(...Xt(n,o)),c=s.filter(k=>k.findIndex(T=>a.includes(T.i))!==-1),h=$t(c),u=s.filter(k=>k.length<Kt).flat().concat(h);for(const k of u)k.setRGB(255);const d=Dt(h),f=Ae(i,d),p=d.flatMap(k=>k.xy),b=f.flatMap(k=>k.xy),C=qt(p,b);await e({step:"Transforming Grid Perspective"});const g=C(i);Yt(g),await e({step:"Finding Digits"});const M=Me(g,0);await e({step:"Transforming Perspective Again"});const A=C(r);await e({step:"Applying Filters Again"}),Ie(A),Ht(A),await e({step:"Applying Digit Mask"}),Vt(A,M.flat().map(k=>k.i));const le=A.w/9,de=A.h/9;let W=0,P=0,be=0;await e({step:"Creating Digit Canvases"});const Ke=M.map(k=>{const T=Ae(A,k),ee=A.crop(T[0],T[2]),Ze=Math.floor(T[0].y/de),qe=Math.floor(T[0].x/le);return W=Math.max(W,ee.w),P=Math.max(P,ee.h),be+=ee.h,[Ze*9+qe,ee]});await e({step:"Padding Canvases"});const Xe=Math.round(be/M.length);return[Ke.map(([k,T])=>[k,zt(J,T,W,P)]),W,P,Xe]}function qt(t,e){const n=Ot(t,e,!1),o=e[2]-e[0],r=e[5]-e[1],i=e[0],s=e[1];return a=>{const c=new ie(J,o,r);for(const h of c.pixels){const[u,d]=Et(n,h.x+i,h.y+s),f=a.pixel(Math.round(u),Math.round(d));h.setRGB(f!==void 0?f.rgb:255),h.a=255}return c}}const _e=600;async function Jt(t,e){const[n,o,r,i]=await Zt(t,e),s=n.map(h=>h[1].canvas),a=await Gt(o,r,i,s,e),c=Array.from({length:81}).fill(null);return n.forEach(([h],u)=>{c[h]=a[u]}),Promise.resolve(c)}function Qt(t){return new Promise(e=>{const n=new Image;n.onload=function(){const o=document.createElement("canvas"),r=_e/n.width;o.width=_e,o.height=n.height*r,o.getContext("2d").drawImage(n,0,0,o.width,o.height),URL.revokeObjectURL(n.src),e(o)},n.src=URL.createObjectURL(t)})}function se(){return U.exports.createContext(new Proxy({},{get(){throw new Error("Missing Context dependencies")}}))}function Be(){return t=>{const e=t.pipe(tt(nt)).subscribe(()=>e.unsubscribe());return t}}function Pt(t,e,n){const o=U.exports.useMemo(()=>new F,n);return U.exports.useEffect(()=>{const r=o.pipe(q(...e)).subscribe(i=>{t(...i)});return()=>r.unsubscribe()},n),r=>()=>o.next(r)}const Re="RxReactNoValue";function G(t){const e=U.exports.useRef(null);let n=Re,o=!1;if(e.current!==t&&(e.current=t,o=!0,t.subscribe(s=>n=s).unsubscribe(),n===Re))throw et(t);const[r,i]=U.exports.useState(n);return U.exports.useEffect(()=>{const s=t.subscribe(i);return()=>s.unsubscribe()},[t]),o?n:r}class en{constructor(){y(this,"contents$");y(this,"candidates");this.contents$=new H(null),this.candidates=L.reduce((e,n)=>(e[n]=new H(null),e),{})}}class fe{constructor(e){y(this,"occurrences");const n=R(...e.map(o=>o.contents$.pipe(ue(r=>r===null?I([1,0]):R(I([r,1]),o.contents$.pipe(ne(1),we(1),v(()=>[r,-1])))))));this.occurrences=L.reduce((o,r)=>Object.assign(o,{[r]:n.pipe(te((i,[s,a])=>s===r?i+a:i,0))}),{})}}class tn{constructor(e,n,o,r,i){y(this,"gridCell");y(this,"contents$");y(this,"candidates");y(this,"isLocked");y(this,"slices");y(this,"notifyCellUpdate");y(this,"notifyCandidateUpdate");this.gridCell=e,this.slices=n,this.notifyCellUpdate=r,this.notifyCandidateUpdate=i,this.contents$=e.contents$.pipe(O(s=>s===null?I(null):E([I(s),Le(n,s).pipe(v(a=>Math.max(...a)===1))]))),this.candidates=L.reduce((s,a)=>Object.assign(s,{[a]:e.candidates[a].pipe(O(c=>c===null?I(null):E([I(c),Le(n,a).pipe(v(h=>Math.max(...h)===0))])))}),{}),this.isLocked=o}toggleContents(e){this.gridCell.contents$.next(this.gridCell.contents$.value===e?null:e),this.notifyCellUpdate(e)}toggleCandidate(e,n){this.gridCell.candidates[e].next(this.gridCell.candidates[e].value===n?null:n),this.notifyCandidateUpdate(e,n)}}function Le(t,e){return E(t.map(n=>n.occurrences[e]))}const nn=[0,3,6,27,30,33,54,57,60];class on{constructor(e=[],n=!0){y(this,"cells");y(this,"isEmpty$");y(this,"isValid$");y(this,"isSolved$");y(this,"updates$");y(this,"gridCells");this.gridCells=Array.from({length:81}).map(()=>new en),e.forEach((u,d)=>this.gridCells[d].contents$.next(u));const o=L.map(u=>new fe(this.gridCells.slice(u*9-9,u*9))),r=L.map(u=>new fe(ln(u-1).map(d=>this.gridCells[d]))),i=nn.map(u=>new fe(un(u).map(d=>this.gridCells[d])));this.updates$=new F,this.cells=Array.from({length:81}).map((u,d)=>new tn(this.gridCells[d],[o[sn(d)],r[cn(d)],i[dn(d)]],!!e[d]&&n,f=>{this.updates$.next({type:"CellUpdate",cellIndex:d,contents:f})},(f,p)=>{this.updates$.next({type:"CandidateUpdate",cellIndex:d,candidate:f,color:p})}));const s=this.gridCells.map(u=>u.contents$.pipe(ue(d=>d===null?I(0):R(I(1),u.contents$.pipe(ne(1),we(1),v(()=>-1)))))),a=R(...s).pipe(te((u,d)=>u+d,0)),c=n?e.filter(u=>!!u).length:0;this.isEmpty$=a.pipe(v(u=>u===c));const h=R(...[...o,...r,...i].flatMap(u=>L.map(d=>u.occurrences[d].pipe(Y(0),he(),ot())))).pipe(te((u,[d,f])=>f>d&&f>1?u+1:f<d&&f>0?u-1:u,0),he(),Y(0));this.isValid$=h.pipe(v(u=>u===0)),this.isSolved$=E([a,this.isValid$]).pipe(v(([u,d])=>u===81&&d))}getContents(e=!1){return this.gridCells.map((n,o)=>{const r=this.cells[o].isLocked;return!e||r?n.contents$.value:null})}}function rn(t){return Math.floor(t/9)*9}function sn(t){return Math.floor(rn(t)/9)}function an(t){return t%9}function cn(t){return an(t)}function ln(t){const e=t%9;return Array.from({length:9}).map((n,o)=>e+o*9)}function Ne(t){return Math.floor(t/27)*27+t%9-t%3}function dn(t){const e=Ne(t);return e<9?Math.floor(e/3):e<36?Math.floor(3+(e-27)/3):Math.floor(6+(e-54)/3)}function un(t){const e=Ne(t);return[e,e+1,e+2,e+9,e+10,e+11,e+18,e+19,e+20]}const L=[1,2,3,4,5,6,7,8,9],ge=["a","b","c"];function Q(t,e){return new on(t,e)}var z;class hn{constructor(){y(this,"game$");B(this,z,void 0);y(this,"status$");y(this,"canStart$");y(this,"canReset$");y(this,"updates$");this.game$=new H(Q());const e=this.game$.pipe(O(n=>n.isSolved$));S(this,z,new H(x.Creating)),this.status$=w(this,z).pipe(q(e),v(([n,o])=>o?x.Solved:n),oe(1)),this.canStart$=this.game$.pipe(O(n=>E([n.isEmpty$,n.isValid$])),v(([n,o])=>!n&&o)),this.canReset$=this.game$.pipe(O(n=>E([n.isEmpty$,n.isSolved$])),v(([n,o])=>!n&&!o)),this.updates$=new F}startGame(){const e=this.game$.value.getContents();this.game$.next(Q(e)),w(this,z).next(x.Solving),this.updates$.next({type:"StartGameUpdate"})}newGame(){this.game$.next(Q()),w(this,z).next(x.Creating),this.updates$.next({type:"NewGameUpdate"})}resetGame(){const e=this.game$.value.getContents().map((n,o)=>this.game$.value.cells[o].isLocked?n:null);this.game$.next(Q(e)),this.updates$.next({type:"ResetGameUpdate"})}loadGame(e,n=!0){this.game$.next(Q(e,n)),n&&w(this,z).next(x.Solving),this.updates$.next({type:"LoadGameUpdate",contents:e,startGame:n})}}z=new WeakMap;var x;(function(t){t[t.Creating=0]="Creating",t[t.Solving=1]="Solving",t[t.Solved=2]="Solved"})(x||(x={}));function pn(){return new hn}const l=pe.exports.jsx,m=pe.exports.jsxs,$=pe.exports.Fragment,Te=se();function fn(){const{app:t,share:e,saveLoadUndo:n,gridFromImage:o}=U.exports.useContext(Te),r=G(t.status$),i=G(t.canStart$),s=G(t.canReset$),a=G(t.game$),c=r===x.Creating,h=r!==x.Creating&&!s,u=r!==x.Creating&&s,d=r!==x.Creating;function f(p){const b=p.target.files?p.target.files[0]:null;b&&Qt(b).then(o)}return m("div",{className:"ButtonBar",children:[l("button",{onClick:()=>n.undo(),children:l(rt,{})}),c&&l("button",{disabled:!i,onClick:()=>t.startGame(),"data-testid":"button-bar-start",children:l(it,{})}),h&&l("button",{onClick:()=>t.newGame(),"data-testid":"button-bar-new",children:l(st,{})}),u&&l("button",{onClick:()=>t.resetGame(),"data-testid":"button-bar-reset",children:l(at,{})}),!d&&m($,{children:[l("input",{hidden:!0,type:"file",accept:"image/*",onChange:f}),l("button",{onClick:p=>p.currentTarget.previousSibling.click(),children:l(ct,{})})]}),d&&l("button",{onClick:()=>e(a),"data-testid":"button-bar-share",children:l(lt,{})}),l("button",{onClick:()=>n.redo(),children:l(dt,{})})]})}function gn(t,e,n){return function(r){return Jt(r,i=>new Promise(s=>{e.next({body:l("p",{children:i.step}),onRender:s})})).then(i=>{n.next(),t.loadGame(i,!1)})}}const Oe=se();function mn(){var r,i;const{message$:t,dismiss$:e}=U.exports.useContext(Oe),n=G(t);U.exports.useEffect(()=>{n&&n.onRender&&n.onRender()},[n]);const o=n&&n.arrow&&n.arrow.target==="ButtonBar"?{"--arrow-button":n.arrow.button,"--arrow-other-button":n.arrow.otherButton}:void 0;return l("div",{className:`Messages ${n?"-ShowingMessage":""}`,onClick:()=>e.next(),"data-testid":"messages",children:n&&l("div",{className:`--Message ${n.arrow?"-Indicating":""}`,"data-arrow-target":n.arrow&&n.arrow.target,style:o,"data-arrow-other-button":((r=n==null?void 0:n.arrow)==null?void 0:r.target)==="ButtonBar"?(i=n==null?void 0:n.arrow)==null?void 0:i.otherButton:void 0,"data-testid":"messages-message",children:n.body})})}function bn(){const t=new F,e=new F,n=t.pipe(v(o=>wn({a:o,b$:o.mustDismiss?e:R(e,yn(t)),c:void 0})),gt(),Y(void 0),oe(1),Be());return{messages$:t,message$:n,dismiss$:e}}function yn(t){return t.pipe(ut(),oe(1),Be())}function wn({a:t,b$:e,c:n}){return ht(pt.pipe(Y(t),ft(e)),I(n))}const Cn=Object.fromEntries(ge.map((t,e)=>[t,ge[(e+1)%ge.length]])),Ee=se();function xn(){const{selectedNumber$:t,currentColor$:e}=U.exports.useContext(Ee),n=G(t),o=G(e),r=i=>{t.value===i?e.next(Cn[e.value]):t.next(i)};return m("div",{className:"NumberPicker","data-current-color":o,children:[l("div",{style:{"--selected":n},className:"--Selection","data-testid":"number-picker-selection"}),l("ul",{className:"--Values",children:L.map(i=>l("li",{onClick:()=>r(i),style:{"--value":i},children:i},i))})]})}function vn(t){let e=BigInt(t).toString(16);e.length%2&&(e="0"+e);const n=[];let o=0,r,i;for(;o<e.length;)r=parseInt(e.slice(o,o+2),16),i=String.fromCharCode(r),n.push(i),o+=2;return btoa(n.join(""))}function $n(t){const e=atob(t),n=[];return e.split("").forEach(function(o){let r=o.charCodeAt(0).toString(16);r.length%2&&(r="0"+r),n.push(r)}),BigInt("0x"+n.join(""))}function kn(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Sn(t){const e=t.length%4;return e===2?t+="==":e===3&&(t+="="),t.replace(/-/g,"+").replace(/_/g,"/")}const De=[["000000000","_9"],["00000000","_8"],["0000000","_7"],["000000","_6"],["00000","_5"],["0000","_4"],["000","_3"],["00","_2"],["0","_1"],["_","0"]],Un=[...De].reverse();function Gn(t){const e=t.map(r=>r===null?0:r).join(""),n=BigInt(e).toString(),o=De.reduce((r,[i,s])=>r.replaceAll(i,s),n);return kn(vn(o))}function Mn(t){const e=$n(Sn(t)).toString();return Un.reduce((r,[i,s])=>r.replaceAll(s,i),e).padStart(81,"0").split("").map(r=>r==="0"?null:parseInt(r,10))}var me;(function(t){t[t.Mobile=0]="Mobile",t[t.Clipboard=1]="Clipboard"})(me||(me={}));function An(t){if(window.location.hash){const e=Mn(window.location.hash.substring(1));t.loadGame(e,!0),history.replaceState(null,"",".")}}function In(t){const e=new URL(window.location.href);return e.hash=Gn(t.getContents(!0)),typeof navigator.share=="function"?(navigator.share({url:e.toString()}),0):(navigator.clipboard.writeText(e.toString()),1)}function _n(t){return function(n){In(n)===me.Clipboard&&t.next({body:l("p",{children:"Copied Link To Clipboard."})})}}const je=se();var ze;(function(t){t[t.Click=0]="Click",t[t.DblClick=1]="DblClick"})(ze||(ze={}));function Bn(){const{selectedNumber$:t,currentColor$:e,app:n}=U.exports.useContext(je),o=G(n.game$),r=U.exports.useMemo(()=>o.cells.map(i=>({highlightCell$:E([i.contents$,t]).pipe(v(([s,a])=>!!s&&s[0]===a)),highlightCandidate:L.reduce((s,a)=>Object.assign(s,{[a]:E([i.candidates[a],t]).pipe(v(([c,h])=>c!==null&&a===h))}),{})})),[o.cells]);return l("div",{className:"SudokuGrid","data-testid":"sudoku-grid",children:o.cells.map((i,s)=>l(Rn,{cell:i,selectedNumber$:t,currentColor$:e,app:n,highlights:r[s]},s))})}function Rn({cell:t,selectedNumber$:e,currentColor$:n,app:o,highlights:r}){const[i,s]=G(t.contents$)||[null,!0],a=G(r.highlightCell$),c=Pt((h,u,d,f)=>{t.isLocked||(f===x.Creating&&h===0||f===x.Solving&&h===1?t.toggleContents(u):f===x.Solving&&h===0&&t.toggleCandidate(u,d))},[e,n,o.status$],[t,t.isLocked]);return m("div",{className:`--Cell ${t.isLocked?"-Locked":""} ${a?"-Highlight":""} ${i?`-ShowingContents ${s?"-Valid":"-Invalid"}`:"-ShowingCandidates"}`,onClick:c(0),onDoubleClick:c(1),children:[l("div",{className:"--Candidates",children:L.map(h=>l(Ln,{candidate:h,status$:t.candidates[h],isHighlighted$:r.highlightCandidate[h]},h))}),l("div",{className:"--Contents",children:i})]})}function Ln({candidate:t,status$:e,isHighlighted$:n}){const o=G(e),r=G(n);return l("div",{className:`--Candidate ${r?"-Highlight":""} ${o!==null?o[1]?"-Valid":"-Invalid":""}`,"data-candidate-color":o==null?void 0:o[0],children:o!==null?t:" "})}function Nn({context:t,children:e}){const{selectedNumber$:n,currentColor$:o,app:r,saveLoadUndo:i,message$:s,messages$:a,dismiss$:c}=t,h=_n(a),u=gn(r,a,c);return l(Oe.Provider,{value:{message$:s,dismiss$:c},children:l(je.Provider,{value:{selectedNumber$:n,currentColor$:o,app:r},children:l(Ee.Provider,{value:{selectedNumber$:n,currentColor$:o},children:l(Te.Provider,{value:{app:r,share:h,saveLoadUndo:i,gridFromImage:u},children:e})})})})}function Tn(t){return R(t.updates$.pipe(v(e=>({type:"AppUpdate",detail:e}))),t.game$.pipe(O(e=>e.updates$),v(e=>({type:"GridUpdate",detail:e}))))}function On(t){const e=[...t].reverse(),n=e.findIndex(r=>r.type==="AppUpdate"&&r.detail.type==="NewGameUpdate");if(n!==-1)return e.slice(0,n).reverse();const o=e.findIndex(r=>r.type==="AppUpdate"&&r.detail.type==="LoadGameUpdate");return o!==-1?e.slice(0,o+1).reverse():t}function Fe(t,e){I(...e).pipe(q(t.game$)).subscribe(([n,o])=>{Ve(t,o,n)})}function Ve(t,e,n){switch(n.type){case"AppUpdate":En(t,n.detail);break;case"GridUpdate":Dn(e,n.detail);break;default:console.error("Unhandled replayUpdate",(o=>o)(n))}}function En(t,e){switch(e.type){case"LoadGameUpdate":t.loadGame(e.contents,e.startGame);break;case"NewGameUpdate":t.newGame();break;case"ResetGameUpdate":t.resetGame();break;case"StartGameUpdate":t.startGame();break;default:console.error("Unhandled replayAppUpdate",(n=>n)(e))}}function Dn(t,e){switch(e.type){case"CellUpdate":t.cells[e.cellIndex].toggleContents(e.contents);break;case"CandidateUpdate":t.cells[e.cellIndex].toggleCandidate(e.candidate,e.color);break;default:console.error("Unhandled replayGridUpdate",(n=>n)(e))}}function jn(t,e,n,o){switch(o.type){case"AppUpdate":zn(t,n);break;case"GridUpdate":Fn(e,n,o.detail);break;default:console.error("Unhandled rollbackUpdate",(r=>r)(o))}}function zn(t,e){const n=[...e].reverse(),o=n.findIndex(s=>s.type==="AppUpdate"&&["NewGameUpdate","LoadGameUpdate"].includes(s.detail.type)),r=o===-1?n.length:o+1,i=n.slice(0,r).reverse();o===-1&&t.newGame(),Fe(t,i)}function Fn(t,e,n){switch(n.type){case"CellUpdate":t.cells[n.cellIndex].toggleContents(n.contents);break;case"CandidateUpdate":t.cells[n.cellIndex].toggleCandidate(n.candidate,n.color);break;default:console.error("Unhandled replayGridUpdate",(o=>o)(n))}}var V,N;class Vn{constructor(e,n){B(this,V,void 0);B(this,N,void 0);y(this,"collection$");y(this,"updates$");S(this,V,new F),S(this,N,!1);const o=e.pipe(mt(()=>!w(this,N))),r=R(o,w(this,V)).pipe(te((i,s)=>{if(s==="SaveLoadUndoAction_Undo"){const[[a,c]]=i,h=a.pop();return h===void 0?i:(c.push(h),[[a,c],s,h])}else if(s==="SaveLoadUndoAction_Redo"){const[[a,c]]=i,h=c.pop();return h===void 0?i:(a.push(h),[[a,c],s,h])}else{const[[a]]=i;return[[a.concat(s),[]],null,null]}},[n,null,null]),Y([n,null,null]),he(),oe(1));this.collection$=r.pipe(ne(1),v(i=>i[0])),this.updates$=r.pipe(ne(1),ue(([[i],s,a])=>s!==null&&a!==null?I({type:s==="SaveLoadUndoAction_Undo"?"Undo":"Redo",affected:a,history:i}):bt))}undo(){S(this,N,!0),w(this,V).next("SaveLoadUndoAction_Undo"),S(this,N,!1)}redo(){S(this,N,!0),w(this,V).next("SaveLoadUndoAction_Redo"),S(this,N,!1)}}V=new WeakMap,N=new WeakMap;var We;(function(t){t[t.One=0]="One",t[t.Two=1]="Two"})(We||(We={}));const He=1;function Wn(t,e){const n=t.get(),o=(n==null?void 0:n.version)===He?n==null?void 0:n.data:[[],[]],r=new F,i=On(o[0]),s=new Vn(r,[i,o[1]]);return{undo(){s.undo()},redo(){s.redo()},setup(){Fe(e,i),Tn(e).subscribe(r),s.collection$.subscribe(a=>{t.set({version:He,data:a})}),s.updates$.pipe(q(e.game$)).subscribe(([a,c])=>{a.type==="Undo"?jn(e,c,a.history,a.affected):Ve(e,c,a.affected)})}}}function Hn(){const t=new H(1),e=new H("a"),n=pn(),o=Ce("SaveLoadUndo"),r=Ce("Onboarding"),i=Wn(o,n),{messages$:s,message$:a,dismiss$:c}=bn();return{selectedNumber$:t,currentColor$:e,app:n,saveLoadUndoStorage:o,saveLoadUndo:i,onboardingStorage:r,messages$:s,message$:a,dismiss$:c}}function ae(){return window.matchMedia("(hover: none)").matches}function Yn(t,e,n){var f;const o=((f=t.get())==null?void 0:f.seen)||{};function r(p,b,C){o[p]||e.next({body:b,mustDismiss:!0,arrow:C,onRender:()=>{o[p]=!0,t.set({seen:o})}})}const i=n.game$.pipe(O(p=>p.updates$),v(p=>({type:"GameUpdate",detail:p}))),s=n.game$.pipe(O(p=>p.isValid$)),a=n.updates$.pipe(v(p=>({type:"AppUpdate",detail:p}))),c=l("i",{children:ae()?"Tap":"Click"}),h=l("i",{children:ae()?"Double Tap":"Double Click"}),u=l("i",{children:ae()?"Tapping":"Clicking"}),d=ae()?"phone or tablet":"computer";r("welcome",m($,{children:[l("p",{children:"Welcome to my Sudoku app."}),l("p",{children:"I'll be sharing a few details the first time you encounter things."}),m("p",{children:[c," anywhere to dismiss a message."]})]})),r("about",m($,{children:[l("p",{children:"The app has no puzzles of its own."}),l("p",{children:"Instead you can use it to play puzzles from newspapers, sudoku books or other websites."})]})),R(a,i).pipe(Y({type:"InitialUpdate"}),yt(0),q(n.status$,s)).subscribe(([p,b,C])=>{let g,M;p.type==="AppUpdate"?g=p.detail:p.type==="GameUpdate"&&(M=p.detail),b===x.Creating&&(r("create_start",m($,{children:[m("p",{children:["Right now you're in ",l("b",{children:"Create Mode"}),"."]}),l("p",{children:"Here you can add a puzzle to play and share."})]})),r("photo_import",m($,{children:[m("p",{children:["The easiest way is by ",l("b",{children:"Photo Import"}),"."]}),l("p",{children:"You can take a photo or choose an image of a Sudoku Grid."}),l("p",{children:"The entire grid must be in the photo or stange things might happen.."})]})),r("photo_import_button",m("p",{children:[c," the camera icon to use it."]}),{target:"ButtonBar",button:2}),r("create_manual",l("p",{children:"Otherwise you can edit the grid manually."})),r("create_choose_number",m("p",{children:["Start by ",u," a number to select it."]}),{target:"NumberPicker"}),r("create_toggle_cell",m("p",{children:["Then ",c," a cell to add or remove that number."]}),{target:"SudokuGrid"})),g&&g.type==="LoadGameUpdate"&&g.startGame===!1&&(r("photo_import_complete",l($,{children:m("p",{children:["Your ",d," has just trained a simple AI to understand the photo in real time."]})})),C?(r("photo_import_promising",l($,{children:l("p",{children:"It does looks promising but it's best to check it over."})})),r("photo_import_take_again",l($,{children:l("p",{children:"If it's miles off you can try taking the photo again."})}))):r("photo_import_take_again",l($,{children:l("p",{children:"It seems you have some errors. Maybe try taking the photo again."})})),r("photo_import_errors_advice",m($,{children:[l("p",{children:"For best results keep the grid straight and centered."}),l("p",{children:"If it's from a screen, try zooming in and taking the photo from further away."})]})),r("photo_import_errors_fix",l("p",{children:"Sometimes it's quicker to correct a few numbers manually."}))),(C&&g&&g.type==="LoadGameUpdate"&&g.startGame===!1||C&&M!==void 0&&b===x.Creating)&&r("start_game_button",m("p",{children:["This is the ",l("b",{children:"Start Game Button"})," for when you are done creating."]}),{target:"ButtonBar",button:1}),M!==void 0&&r("undo_redo",m($,{children:[m("p",{children:["The ",l("b",{children:"Undo and Redo Buttons"})," are available to correct errors."]}),l("p",{children:"They even work if you start or clear the game."})]}),{target:"ButtonBar",button:0,otherButton:3}),g&&g.type==="LoadGameUpdate"&&g.startGame===!0&&r("arrive_from_link",l("p",{children:"You've arrived from a shared puzzle link so you can start solving right away."})),g&&g.type==="StartGameUpdate"&&r("start_game",m("p",{children:["The puzzle cells are now locked and you're in ",l("b",{children:"Solve Mode"}),"."]})),b===x.Solving&&(r("solving_choose_number",m("p",{children:["Start by ",u," a number to select it."]}),{target:"NumberPicker"}),r("solving_toggle_cell_solution",l($,{children:m("p",{children:[h," to add or remove the chosen number as a Solution."]})}),{target:"SudokuGrid"}),r("solving_toggle_cell_candidate",l($,{children:m("p",{children:[c," a cell to add or remove the chosen number as a Candidate."]})}),{target:"SudokuGrid"}),r("solving_candidate_colouring",l($,{children:l("p",{children:"Advanced Feature: Tap the selected number to cycle through candidate colours."})}),{target:"NumberPicker"})),M!==void 0&&M.type==="CellUpdate"&&b===x.Solving&&(r("reset_button",m($,{children:[m("p",{children:["The ",l("b",{children:"Reset Button"})," will start the puzzle again."]}),m("p",{children:[c," it twice to go back to Create Mode."]}),l("p",{children:"These actions can be undone."})]}),{target:"ButtonBar",button:1}),r("save_progress",m($,{children:[l("p",{children:"Your progress is being saved so you can continue later if you need to."}),l("p",{children:"You can even play when you are offline."})]})),r("share_button",m($,{children:[m("p",{children:[c," the ",l("b",{children:"Share Button"})," any time to share puzzles with friends."]}),l("p",{children:"Shared puzzles won't include any of your current progress."}),l("p",{children:"I'll leave you in peace now. Enjoy!"})]}),{target:"ButtonBar",button:2})),b===x.Solved&&(r("complete",m($,{children:[l("p",{children:"All done. I hope this first puzzle was a smooth experience."}),m("p",{children:["The ",l("b",{children:"Bin Button"})," will clear the grid and return to Create Mode."]})]}),{target:"ButtonBar",button:1}),r("final_share",m("p",{children:["Maybe you want to ",l("b",{children:"Share"})," the puzzle before you do that?"]}),{target:"ButtonBar",button:2}))})}let Ye={enable(){}};navigator.userAgent.includes("jsdom")||(Ye=new wt);function Kn(){const t=Hn(),{saveLoadUndo:e,onboardingStorage:n,messages$:o,app:r}=t;U.exports.useEffect(()=>{e.setup(),Yn(n,o,r),An(r)},[]);function i(){Ye.enable()}return l(Nn,{context:t,children:m("div",{className:"SudokuApp",onClick:i,children:[l(mn,{}),l(Bn,{}),l(xn,{}),l(fn,{})]})})}function Xn(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:o,onRegistered:r,onRegisterError:i}=t;let s;const a=async(c=!0)=>{};return"serviceWorker"in navigator&&(s=new Ct("/sudoku/sw.js",{scope:"/sudoku/",type:"classic"}),s.addEventListener("activated",c=>{c.isUpdate?window.location.reload():o==null||o()}),s.register({immediate:e}).then(c=>{r==null||r(c)}).catch(c=>{i==null||i(c)})),a}Xn();xt.exports.render(l(Kn,{}),document.getElementById("root"));
