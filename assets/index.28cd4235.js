var q=Object.defineProperty;var J=(t,e,n)=>e in t?q(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var c=(t,e,n)=>(J(t,typeof e!="symbol"?e+"":e,n),n);import{m as b,s as S,a as u,b as y,o as v,w as B,B as k,c as M,d as w,t as A,e as x,f as R,g as O,p as X,S as E,r as h,h as z,j as I,i as Q,k as Y,l as Z}from"./vendor.50698a0b.js";const ee=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}};ee();var V;(function(t){t[t.One=0]="One"})(V||(V={}));function te(t){return b(t.updates$.pipe(u(e=>({type:"AppUpdate",detail:e}))),t.game$.pipe(S(e=>e.updates$),u(e=>({type:"GridUpdate",detail:e}))))}function se(t){return t.type==="AppUpdate"&&t.detail.type==="StartGameUpdate"}function ne(t,e){var r;const n=((r=t.get())==null?void 0:r.updates)||[];return e.pipe(y((s,i)=>{if(i.type==="AppUpdate"&&i.detail.type==="NewGameUpdate")return[];if(i.type==="AppUpdate"&&i.detail.type==="ResetGameUpdate"){for(;s.length>0&&!se(s[s.length-1]);)s.pop();return s}else return s.concat(i)},n)).subscribe(s=>{t.set({version:0,updates:s})})}function ie(t,e){var r;const n=((r=t.get())==null?void 0:r.updates)||[];v(...n).pipe(B(e.game$)).subscribe(([s,i])=>{s.type==="GridUpdate"&&s.detail.type==="CellUpdate"?i.cells[s.detail.cellIndex].toggleContents(s.detail.contents):s.type==="GridUpdate"&&s.detail.type==="CandidateUpdate"?i.cells[s.detail.cellIndex].toggleCandidate(s.detail.candidate):s.type==="AppUpdate"&&s.detail.type==="StartGameUpdate"&&e.startGame()})}class re{constructor(){c(this,"contents$");c(this,"candidates");this.contents$=new k(null),this.candidates=f.reduce((e,n)=>(e[n]=new k(!1),e),{})}}class U{constructor(e){c(this,"occurrences");const n=b(...e.map(r=>r.contents$.pipe(M(s=>s===null?v([1,0]):b(v([s,1]),r.contents$.pipe(w(1),A(1),u(()=>[s,-1])))))));this.occurrences=f.reduce((r,s)=>Object.assign(r,{[s]:n.pipe(y((i,[l,m])=>l===s?i+m:i,0))}),{})}}class ae{constructor(e,n,r){c(this,"gridCell");c(this,"contents$");c(this,"candidates");c(this,"isLocked");c(this,"slices");this.gridCell=e,this.slices=n,this.contents$=e.contents$.pipe(S(s=>s===null?v(null):x([v(s),j(n,s).pipe(u(i=>Math.max(...i)===1))]))),this.candidates=f.reduce((s,i)=>Object.assign(s,{[i]:e.candidates[i].pipe(S(l=>l?j(n,i).pipe(u(m=>Math.max(...m)===0)):v(null)))}),{}),this.isLocked=r}toggleContents(e){this.gridCell.contents$.next(this.gridCell.contents$.value===e?null:e)}toggleCandidate(e){this.gridCell.candidates[e].next(!this.gridCell.candidates[e].value)}}function j(t,e){return x(t.map(n=>n.occurrences[e]))}const oe=[0,3,6,27,30,33,54,57,60];class le{constructor(e){c(this,"cells");c(this,"isEmpty$");c(this,"isValid$");c(this,"isSolved$");c(this,"updates$");c(this,"gridCells");this.gridCells=Array.from({length:81}).map(()=>new re),e&&e.forEach((a,o)=>this.gridCells[o].contents$.next(a));const n=f.map(a=>new U(this.gridCells.slice(a*9-9,a*9))),r=f.map(a=>new U(he(a-1).map(o=>this.gridCells[o]))),s=oe.map(a=>new U(me(a).map(o=>this.gridCells[o])));this.cells=Array.from({length:81}).map((a,o)=>new ae(this.gridCells[o],[n[de(o)],r[pe(o)],s[ge(o)]],!!(e==null?void 0:e[o]))),this.updates$=b(...this.gridCells.map((a,o)=>b(a.contents$.pipe(w(1),u($=>({type:"CellUpdate",cellIndex:o,contents:$}))),...f.map($=>a.candidates[$].pipe(w(1),u(W=>({type:"CandidateUpdate",cellIndex:o,candidate:$,isShowing:W})))))));const i=this.gridCells.map(a=>a.contents$.pipe(M(o=>o===null?v(0):b(v(1),a.contents$.pipe(w(1),A(1),u(()=>-1)))))),l=b(...i).pipe(y((a,o)=>a+o,0)),m=e?e.filter(a=>!!a).length:0;this.isEmpty$=l.pipe(u(a=>a===m));const p=b(...[...n,...r,...s].flatMap(a=>f.map(o=>a.occurrences[o].pipe(R(0),O(),X())))).pipe(y((a,[o,$])=>$>o&&$>1?a+1:$<o&&$>0?a-1:a,0),O(),R(0));this.isValid$=p.pipe(u(a=>a===0)),this.isSolved$=x([l,this.isValid$]).pipe(u(([a,o])=>a===81&&o))}getContents(){return this.gridCells.map(e=>e.contents$.value)}}function ce(t){return Math.floor(t/9)*9}function de(t){return Math.floor(ce(t)/9)}function ue(t){return t%9}function pe(t){return ue(t)}function he(t){const e=t%9;return Array.from({length:9}).map((n,r)=>e+r*9)}function P(t){return Math.floor(t/27)*27+t%9-t%3}function ge(t){const e=P(t);return e<9?Math.floor(e/3):e<36?Math.floor(3+(e-27)/3):Math.floor(6+(e-54)/3)}function me(t){const e=P(t);return[e,e+1,e+2,e+9,e+10,e+11,e+18,e+19,e+20]}const f=[1,2,3,4,5,6,7,8,9];function N(t){return new le(t)}class fe{constructor(){c(this,"status$");c(this,"game$");c(this,"canStart$");c(this,"canReset$");c(this,"updates$");this.status$=new k(g.Creating),this.game$=new k(N()),this.canStart$=this.game$.pipe(S(e=>x([e.isEmpty$,e.isValid$])),u(([e,n])=>!e&&n)),this.canReset$=this.game$.pipe(S(e=>x([e.isEmpty$,e.isSolved$])),u(([e,n])=>!e&&!n)),this.updates$=new E}startGame(){const e=this.game$.value.getContents();this.game$.next(N(e)),this.status$.next(g.Solving),this.updates$.next({type:"StartGameUpdate"})}newGame(){this.game$.next(N()),this.status$.next(g.Creating),this.updates$.next({type:"NewGameUpdate"})}resetGame(){const e=this.game$.value.getContents().map((n,r)=>this.game$.value.cells[r].isLocked?n:null);this.game$.next(N(e)),this.updates$.next({type:"ResetGameUpdate"})}}var g;(function(t){t[t.Creating=0]="Creating",t[t.Solving=1]="Solving",t[t.Solved=2]="Solved"})(g||(g={}));function $e(){return new fe}function L(){return h.exports.createContext(new Proxy({},{get(){throw new Error("Missing Context dependencies")}}))}function Ce(t,e,n){const r=h.exports.useMemo(()=>new E,n);return h.exports.useEffect(()=>{const s=r.pipe(B(...e)).subscribe(i=>{t(...i)});return()=>s.unsubscribe()},n),s=>()=>r.next(s)}const D="RxReactNoValue";function C(t){const e=h.exports.useRef(null);let n=D,r=!1;if(e.current!==t&&(e.current=t,r=!0,t.subscribe(l=>n=l).unsubscribe(),n===D))throw z(t);const[s,i]=h.exports.useState(n);return h.exports.useEffect(()=>{const l=t.subscribe(i);return()=>l.unsubscribe()},[t]),r?n:s}const d=I.exports.jsx,G=I.exports.jsxs,_=L();function be(){const{app:t}=h.exports.useContext(_),e=C(t.status$),n=C(t.canStart$),r=C(t.canReset$),s=e===g.Creating,i=e!==g.Creating&&!r,l=e!==g.Creating&&r;return G("div",{className:"ButtonBar",children:[s&&d("button",{disabled:!n,onClick:()=>t.startGame(),children:"Start"}),i&&d("button",{onClick:()=>t.newGame(),children:"New Game"}),l&&d("button",{onClick:()=>t.resetGame(),children:"Reset Game"})]})}const F=L();function ve(){const{selectedNumber$:t}=h.exports.useContext(F),e=C(t);return G("div",{className:"NumberPicker",children:[d("div",{style:{"--selected":e},className:"--Selection","data-testid":"number-picker-selection"}),d("ul",{className:"--Values",children:f.map(n=>d("li",{onClick:()=>t.next(n),style:{"--value":n},children:n},n))})]})}const H=L();var K;(function(t){t[t.Click=0]="Click",t[t.DblClick=1]="DblClick"})(K||(K={}));function xe(){const{selectedNumber$:t,app:e}=h.exports.useContext(H),n=C(e.game$),r=h.exports.useMemo(()=>n.cells.map(s=>({highlightCell$:x([s.contents$,t]).pipe(u(([i,l])=>!!i&&i[0]===l)),highlightCandidate:f.reduce((i,l)=>Object.assign(i,{[l]:x([s.candidates[l],t]).pipe(u(([m,p])=>m!==null&&l===p))}),{})})),[n.cells]);return d("div",{className:"SudokuGrid","data-testid":"sudoku-grid",children:n.cells.map((s,i)=>d(Se,{cell:s,selectedNumber$:t,app:e,highlights:r[i]},i))})}function Se({cell:t,selectedNumber$:e,app:n,highlights:r}){const[s,i]=C(t.contents$)||[null,!0],l=C(r.highlightCell$),m=Ce((p,a,o)=>{t.isLocked||(o===g.Creating&&p===0||o===g.Solving&&p===1?t.toggleContents(a):o===g.Solving&&p===0&&t.toggleCandidate(a))},[e,n.status$],[t,t.isLocked]);return G("div",{className:`--Cell ${t.isLocked?"-Locked":""} ${l?"-Highlight":""} ${s?`-ShowingContents ${i?"-Valid":"-Invalid"}`:"-ShowingCandidates"}`,onClick:m(0),onDoubleClick:m(1),children:[d("div",{className:"--Candidates",children:f.map(p=>d(ke,{candidate:p,status$:t.candidates[p],isHighlighted$:r.highlightCandidate[p]},p))}),d("div",{className:"--Contents",children:s})]})}function ke({candidate:t,status$:e,isHighlighted$:n}){const r=C(e),s=C(n);return d("div",{className:`--Candidate ${s?"-Highlight":""} ${r!==null?r?"-Valid":"-Invalid":""}`,children:r!==null?t:" "})}let T={enable(){}};navigator.userAgent.includes("jsdom")||(T=new Q);function ye(){const t=new k(1),e=$e();h.exports.useEffect(()=>{const r=Y("SaveLoadUndo");ie(r,e);const s=te(e);ne(r,s)},[]);function n(){typeof process!="undefined"&&{}.JEST_WORKER_ID===void 0&&T.enable()}return G("div",{className:"SudokuApp",onClick:n,children:[d(H.Provider,{value:{selectedNumber$:t,app:e},children:d(xe,{})}),d(F.Provider,{value:{selectedNumber$:t},children:d(ve,{})}),d(_.Provider,{value:{app:e},children:d(be,{})})]})}Z.exports.render(d(ye,{}),document.getElementById("root"));
