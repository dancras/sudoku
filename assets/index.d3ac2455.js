var ne=Object.defineProperty;var se=(t,e,n)=>e in t?ne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var p=(t,e,n)=>(se(t,typeof e!="symbol"?e+"":e,n),n),V=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var x=(t,e,n)=>(V(t,e,"read from private field"),n?n.call(t):e.get(t)),B=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},k=(t,e,n,o)=>(V(t,e,"write to private field"),o?o.call(t,n):e.set(t,n),n);import{m as $,s as G,a as h,o as v,w as _,S as I,f as oe,b as N,c as O,d as M,e as re,g as S,h as E,E as ie,B as A,t as T,i as w,p as ae,r as f,j as le,k as D,I as ce,l as de,n as ue,q as pe,u as he,v as ge,x as fe,y as me,z as be,A as Ce}from"./vendor.066afb1d.js";const $e=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}};$e();function ve(t){return $(t.updates$.pipe(h(e=>({type:"AppUpdate",detail:e}))),t.game$.pipe(G(e=>e.updates$),h(e=>({type:"GridUpdate",detail:e}))))}function F(t,e){v(...e).pipe(_(t.game$)).subscribe(([n,o])=>{W(t,o,n)})}function W(t,e,n){switch(n.type){case"AppUpdate":Ue(t,n.detail);break;case"GridUpdate":ke(e,n.detail);break;default:console.error("Unhandled replayUpdate",(o=>o)(n))}}function Ue(t,e){switch(e.type){case"LoadGameUpdate":t.loadGame(e.contents);break;case"NewGameUpdate":t.newGame();break;case"ResetGameUpdate":t.resetGame();break;case"StartGameUpdate":t.startGame();break;default:console.error("Unhandled replayAppUpdate",(n=>n)(e))}}function ke(t,e){switch(e.type){case"CellUpdate":t.cells[e.cellIndex].toggleContents(e.contents);break;case"CandidateUpdate":t.cells[e.cellIndex].toggleCandidate(e.candidate);break;default:console.error("Unhandled replayGridUpdate",(n=>n)(e))}}function we(t,e,n,o){switch(o.type){case"AppUpdate":ye(t,n);break;case"GridUpdate":Se(e,n,o.detail);break;default:console.error("Unhandled rollbackUpdate",(s=>s)(o))}}function ye(t,e){const n=[...e].reverse(),o=n.findIndex(i=>i.type==="AppUpdate"&&["NewGameUpdate","LoadGameUpdate"].includes(i.detail.type)),s=o===-1?n.length:o+1,r=n.slice(0,s).reverse();o===-1&&t.newGame(),F(t,r)}function Se(t,e,n){switch(n.type){case"CellUpdate":xe(t,e,n.cellIndex);break;case"CandidateUpdate":t.cells[n.cellIndex].toggleCandidate(n.candidate);break;default:console.error("Unhandled replayGridUpdate",(o=>o)(n))}}function xe(t,e,n){const o=[...e].reverse(),s=o.findIndex(l=>l.type==="AppUpdate"||Ge(l,n)),r=o[s];let i=null;r&&r.type==="GridUpdate"&&r.detail.type==="CellUpdate"?i=r.detail.contents:r&&r.type==="AppUpdate"&&r.detail.type==="LoadGameUpdate"&&(i=r.detail.contents[n]),t.cells[n].toggleContents(i)}function Ge(t,e){return t.type==="GridUpdate"&&t.detail.type==="CellUpdate"&&t.detail.cellIndex===e}var y,U;class Ae{constructor(e,n){B(this,y,void 0);B(this,U,void 0);p(this,"collection$");p(this,"updates$");k(this,y,new I),k(this,U,!1);const o=e.pipe(oe(()=>!x(this,U))),s=$(o,x(this,y)).pipe(N((r,i)=>{if(i==="SaveLoadUndoAction_Undo"){const[[l,u]]=r,a=l.pop();return a===void 0?r:(u.push(a),[[l,u],i,a])}else if(i==="SaveLoadUndoAction_Redo"){const[[l,u]]=r,a=u.pop();return a===void 0?r:(l.push(a),[[l,u],i,a])}else{const[[l]]=r;return[[l.concat(i),[]],null,null]}},[n,null,null]),O([n,null,null]),M(),re(1));this.collection$=s.pipe(S(1),h(r=>r[0])),this.updates$=s.pipe(S(1),E(([[r],i,l])=>i!==null&&l!==null?v({type:i==="SaveLoadUndoAction_Undo"?"Undo":"Redo",affected:l,history:r}):ie))}undo(){k(this,U,!0),x(this,y).next("SaveLoadUndoAction_Undo"),k(this,U,!1)}redo(){k(this,U,!0),x(this,y).next("SaveLoadUndoAction_Redo"),k(this,U,!1)}}y=new WeakMap,U=new WeakMap;var H;(function(t){t[t.One=0]="One"})(H||(H={}));function Le(t,e){var r;const n=((r=t.get())==null?void 0:r.data)||[[],[]],o=new I,s=new Ae(o,n);return{undo(){s.undo()},redo(){s.redo()},setup(){F(e,n[0]),ve(e).subscribe(o),s.collection$.subscribe(i=>{t.set({version:0,data:i})}),s.updates$.pipe(_(e.game$)).subscribe(([i,l])=>{i.type==="Undo"?we(e,l,i.history,i.affected):W(e,l,i.affected)})}}}function Ie(t){let e=BigInt(t).toString(16);e.length%2&&(e="0"+e);const n=[];let o=0,s,r;for(;o<e.length;)s=parseInt(e.slice(o,o+2),16),r=String.fromCharCode(s),n.push(r),o+=2;return btoa(n.join(""))}function Ne(t){const e=atob(t),n=[];return e.split("").forEach(function(o){let s=o.charCodeAt(0).toString(16);s.length%2&&(s="0"+s),n.push(s)}),BigInt("0x"+n.join(""))}function Re(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Be(t){const e=t.length%4;return e===2?t+="==":e===3&&(t+="="),t.replace(/-/g,"+").replace(/_/g,"/")}const Z=[["000000000","_9"],["00000000","_8"],["0000000","_7"],["000000","_6"],["00000","_5"],["0000","_4"],["000","_3"],["00","_2"],["0","_1"],["_","0"]],_e=[...Z].reverse();function Oe(t){const e=t.map(s=>s===null?0:s).join(""),n=BigInt(e).toString(),o=Z.reduce((s,[r,i])=>s.replaceAll(r,i),n);return Re(Ie(o))}function Me(t){const e=Ne(Be(t)).toString();return _e.reduce((s,[r,i])=>s.replaceAll(i,r),e).padStart(81,"0").split("").map(s=>s==="0"?null:parseInt(s,10))}function Ee(t){if(window.location.hash){const e=Me(window.location.hash.substring(1));t.loadGame(e),history.replaceState(null,"",".")}}function Pe(t){const e=new URL(window.location.href);e.hash=Oe(t.getContents()),typeof navigator.share=="function"?navigator.share({url:e.toString()}):navigator.clipboard.writeText(e.toString())}class je{constructor(){p(this,"contents$");p(this,"candidates");this.contents$=new A(null),this.candidates=m.reduce((e,n)=>(e[n]=new A(!1),e),{})}}class P{constructor(e){p(this,"occurrences");const n=$(...e.map(o=>o.contents$.pipe(E(s=>s===null?v([1,0]):$(v([s,1]),o.contents$.pipe(S(1),T(1),h(()=>[s,-1])))))));this.occurrences=m.reduce((o,s)=>Object.assign(o,{[s]:n.pipe(N((r,[i,l])=>i===s?r+l:r,0))}),{})}}class Ve{constructor(e,n,o){p(this,"gridCell");p(this,"contents$");p(this,"candidates");p(this,"isLocked");p(this,"slices");this.gridCell=e,this.slices=n,this.contents$=e.contents$.pipe(G(s=>s===null?v(null):w([v(s),K(n,s).pipe(h(r=>Math.max(...r)===1))]))),this.candidates=m.reduce((s,r)=>Object.assign(s,{[r]:e.candidates[r].pipe(G(i=>i?K(n,r).pipe(h(l=>Math.max(...l)===0)):v(null)))}),{}),this.isLocked=o}toggleContents(e){this.gridCell.contents$.next(this.gridCell.contents$.value===e?null:e)}toggleCandidate(e){this.gridCell.candidates[e].next(!this.gridCell.candidates[e].value)}}function K(t,e){return w(t.map(n=>n.occurrences[e]))}const Te=[0,3,6,27,30,33,54,57,60];class De{constructor(e){p(this,"cells");p(this,"isEmpty$");p(this,"isValid$");p(this,"isSolved$");p(this,"updates$");p(this,"gridCells");this.gridCells=Array.from({length:81}).map(()=>new je),e&&e.forEach((a,c)=>this.gridCells[c].contents$.next(a));const n=m.map(a=>new P(this.gridCells.slice(a*9-9,a*9))),o=m.map(a=>new P(Ke(a-1).map(c=>this.gridCells[c]))),s=Te.map(a=>new P(ze(a).map(c=>this.gridCells[c])));this.cells=Array.from({length:81}).map((a,c)=>new Ve(this.gridCells[c],[n[We(c)],o[Ze(c)],s[qe(c)]],!!(e==null?void 0:e[c]))),this.updates$=$(...this.gridCells.map((a,c)=>$(a.contents$.pipe(S(1),h(C=>({type:"CellUpdate",cellIndex:c,contents:C}))),...m.map(C=>a.candidates[C].pipe(S(1),h(te=>({type:"CandidateUpdate",cellIndex:c,candidate:C,isShowing:te})))))));const r=this.gridCells.map(a=>a.contents$.pipe(E(c=>c===null?v(0):$(v(1),a.contents$.pipe(S(1),T(1),h(()=>-1)))))),i=$(...r).pipe(N((a,c)=>a+c,0)),l=e?e.filter(a=>!!a).length:0;this.isEmpty$=i.pipe(h(a=>a===l));const u=$(...[...n,...o,...s].flatMap(a=>m.map(c=>a.occurrences[c].pipe(O(0),M(),ae())))).pipe(N((a,[c,C])=>C>c&&C>1?a+1:C<c&&C>0?a-1:a,0),M(),O(0));this.isValid$=u.pipe(h(a=>a===0)),this.isSolved$=w([i,this.isValid$]).pipe(h(([a,c])=>a===81&&c))}getContents(){return this.gridCells.map(e=>e.contents$.value)}}function Fe(t){return Math.floor(t/9)*9}function We(t){return Math.floor(Fe(t)/9)}function He(t){return t%9}function Ze(t){return He(t)}function Ke(t){const e=t%9;return Array.from({length:9}).map((n,o)=>e+o*9)}function q(t){return Math.floor(t/27)*27+t%9-t%3}function qe(t){const e=q(t);return e<9?Math.floor(e/3):e<36?Math.floor(3+(e-27)/3):Math.floor(6+(e-54)/3)}function ze(t){const e=q(t);return[e,e+1,e+2,e+9,e+10,e+11,e+18,e+19,e+20]}const m=[1,2,3,4,5,6,7,8,9];function L(t){return new De(t)}class Je{constructor(){p(this,"status$");p(this,"game$");p(this,"canStart$");p(this,"canReset$");p(this,"updates$");this.status$=new A(g.Creating),this.game$=new A(L()),this.canStart$=this.game$.pipe(G(e=>w([e.isEmpty$,e.isValid$])),h(([e,n])=>!e&&n)),this.canReset$=this.game$.pipe(G(e=>w([e.isEmpty$,e.isSolved$])),h(([e,n])=>!e&&!n)),this.updates$=new I}startGame(){const e=this.game$.value.getContents();this.game$.next(L(e)),this.status$.next(g.Solving),this.updates$.next({type:"StartGameUpdate"})}newGame(){this.game$.next(L()),this.status$.next(g.Creating),this.updates$.next({type:"NewGameUpdate"})}resetGame(){const e=this.game$.value.getContents().map((n,o)=>this.game$.value.cells[o].isLocked?n:null);this.game$.next(L(e)),this.updates$.next({type:"ResetGameUpdate"})}loadGame(e){this.game$.next(L(e)),this.status$.next(g.Solving),this.updates$.next({type:"LoadGameUpdate",contents:e})}}var g;(function(t){t[t.Creating=0]="Creating",t[t.Solving=1]="Solving",t[t.Solved=2]="Solved"})(g||(g={}));function Xe(){return new Je}function j(){return f.exports.createContext(new Proxy({},{get(){throw new Error("Missing Context dependencies")}}))}function Ye(t,e,n){const o=f.exports.useMemo(()=>new I,n);return f.exports.useEffect(()=>{const s=o.pipe(_(...e)).subscribe(r=>{t(...r)});return()=>s.unsubscribe()},n),s=>()=>o.next(s)}const z="RxReactNoValue";function b(t){const e=f.exports.useRef(null);let n=z,o=!1;if(e.current!==t&&(e.current=t,o=!0,t.subscribe(i=>n=i).unsubscribe(),n===z))throw le(t);const[s,r]=f.exports.useState(n);return f.exports.useEffect(()=>{const i=t.subscribe(r);return()=>i.unsubscribe()},[t]),o?n:s}const d=D.exports.jsx,R=D.exports.jsxs,J=j();function Qe(){const{app:t,share:e,saveLoadUndo:n}=f.exports.useContext(J),o=b(t.status$),s=b(t.canStart$),r=b(t.canReset$),i=b(t.game$),l=o===g.Creating,u=o!==g.Creating&&!r,a=o!==g.Creating&&r,c=o!==g.Creating;return R("div",{className:"ButtonBar",children:[d("button",{onClick:()=>n.undo(),children:d(ce,{})}),l&&d("button",{disabled:!s,onClick:()=>t.startGame(),"data-testid":"button-bar-start",children:d(de,{})}),u&&d("button",{onClick:()=>t.newGame(),"data-testid":"button-bar-new",children:d(ue,{})}),a&&d("button",{onClick:()=>t.resetGame(),"data-testid":"button-bar-reset",children:d(pe,{})}),d("button",{disabled:!c,onClick:()=>e(i),"data-testid":"button-bar-share",children:d(he,{})}),d("button",{onClick:()=>n.redo(),children:d(ge,{})})]})}const X=j();function et(){const{selectedNumber$:t}=f.exports.useContext(X),e=b(t);return R("div",{className:"NumberPicker",children:[d("div",{style:{"--selected":e},className:"--Selection","data-testid":"number-picker-selection"}),d("ul",{className:"--Values",children:m.map(n=>d("li",{onClick:()=>t.next(n),style:{"--value":n},children:n},n))})]})}const Y=j();var Q;(function(t){t[t.Click=0]="Click",t[t.DblClick=1]="DblClick"})(Q||(Q={}));function tt(){const{selectedNumber$:t,app:e}=f.exports.useContext(Y),n=b(e.game$),o=f.exports.useMemo(()=>n.cells.map(s=>({highlightCell$:w([s.contents$,t]).pipe(h(([r,i])=>!!r&&r[0]===i)),highlightCandidate:m.reduce((r,i)=>Object.assign(r,{[i]:w([s.candidates[i],t]).pipe(h(([l,u])=>l!==null&&i===u))}),{})})),[n.cells]);return d("div",{className:"SudokuGrid","data-testid":"sudoku-grid",children:n.cells.map((s,r)=>d(nt,{cell:s,selectedNumber$:t,app:e,highlights:o[r]},r))})}function nt({cell:t,selectedNumber$:e,app:n,highlights:o}){const[s,r]=b(t.contents$)||[null,!0],i=b(o.highlightCell$),l=Ye((u,a,c)=>{t.isLocked||(c===g.Creating&&u===0||c===g.Solving&&u===1?t.toggleContents(a):c===g.Solving&&u===0&&t.toggleCandidate(a))},[e,n.status$],[t,t.isLocked]);return R("div",{className:`--Cell ${t.isLocked?"-Locked":""} ${i?"-Highlight":""} ${s?`-ShowingContents ${r?"-Valid":"-Invalid"}`:"-ShowingCandidates"}`,onClick:l(0),onDoubleClick:l(1),children:[d("div",{className:"--Candidates",children:m.map(u=>d(st,{candidate:u,status$:t.candidates[u],isHighlighted$:o.highlightCandidate[u]},u))}),d("div",{className:"--Contents",children:s})]})}function st({candidate:t,status$:e,isHighlighted$:n}){const o=b(e),s=b(n);return d("div",{className:`--Candidate ${s?"-Highlight":""} ${o!==null?o?"-Valid":"-Invalid":""}`,children:o!==null?t:" "})}let ee={enable(){}};navigator.userAgent.includes("jsdom")||(ee=new fe);function ot(){const t=new A(1),e=Xe(),n=me("SaveLoadUndo"),o=Le(n,e);f.exports.useEffect(()=>{o.setup(),Ee(e)},[]);function s(){typeof process!="undefined"&&{}.JEST_WORKER_ID===void 0&&ee.enable()}return R("div",{className:"SudokuApp",onClick:s,children:[d(Y.Provider,{value:{selectedNumber$:t,app:e},children:d(tt,{})}),d(X.Provider,{value:{selectedNumber$:t},children:d(et,{})}),d(J.Provider,{value:{app:e,share:Pe,saveLoadUndo:o},children:d(Qe,{})})]})}function rt(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:o,onRegistered:s,onRegisterError:r}=t;let i;const l=async(u=!0)=>{};return"serviceWorker"in navigator&&(i=new be("/sudoku/sw.js",{scope:"/sudoku/",type:"classic"}),i.addEventListener("activated",u=>{u.isUpdate?window.location.reload():o==null||o()}),i.register({immediate:e}).then(u=>{s==null||s(u)}).catch(u=>{r==null||r(u)})),l}rt();Ce.exports.render(d(ot,{}),document.getElementById("root"));
