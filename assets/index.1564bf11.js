var tt=Object.defineProperty;var nt=(t,e,n)=>e in t?tt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var w=(t,e,n)=>(nt(t,typeof e!="symbol"?e+"":e,n),n),Ce=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var y=(t,e,n)=>(Ce(t,e,"read from private field"),n?n.call(t):e.get(t)),L=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},U=(t,e,n,o)=>(Ce(t,e,"write to private field"),o?o.call(t,n):e.set(t,n),n);import{K as ot,r as G,f as rt,S as V,w as P,o as it,a as st,B as K,m as A,b as he,s as ee,c as _,d as X,t as xe,e as x,g as E,h as D,i as Z,j as fe,p as at,k as ie,l as ge,I as ct,n as lt,q as dt,u as ut,v as pt,x as ht,y as ft,z as gt,A as mt,N as bt,C as yt,D as wt,E as Ct,F as xt,G as ve,H as vt,J as $t,L as Ut,M as kt}from"./vendor.e007f03c.js";const St=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}};St();const S=(...t)=>t;function te(t=0,e=0){const n=document.createElement("canvas");return n.width=t,n.height=e,n}function $e(t,e){return Array.from({length:e-t}).map((n,o)=>t+o)}function Gt(t){let e=[];for(const n of t)n.length>e.length&&(e=n);return e}const At=["1","2","3","4","5","6","7","8","9"],It=["Andale Mono, Menlo","Arial","Cambria, Gill Sans","Comic Sans MS, Chalkboard SE","Courier","Impact, Avenir Next Condensed","Times New Roman","Trebuchet MS","Verdana"],Mt=["bold",""];async function Bt(t,e,n,o,r){const i=[n,n-1,n-2,n-3];let s=[];await r({step:"Generating Font Combinations"});for(const u of At)for(const f of It)for(const h of Mt)for(const b of i){const C=te(t,e),g=C.getContext("2d");g.fillStyle="white",g.fillRect(0,0,t,e),g.fillStyle="black";const M=_t(g,h,f,b);g.font=`${h} ${M}px ${f}`;const B=g.measureText(u),ue=B.actualBoundingBoxLeft+B.actualBoundingBoxRight,pe=B.actualBoundingBoxLeft+Math.round((t-ue)/2),Y=Math.round((e-b)/2);g.fillText(u,pe,e-Y),s.push([C,parseInt(u,10)])}await r({step:"Generating Training Set"}),s=s.flatMap(([u,f])=>[S(u,f),S(se(u,1,0),f),S(se(u,-1,0),f),S(se(u,0,1),f),S(se(u,0,-1),f)]),await r({step:"Training KNN Model"});const c=s.map(u=>u[1]),a=s.map(u=>Ue(u[0])),p=new ot(a,c);await r({step:"Running KNN Model"});const l=o.map(Ue);return p.predict(l)}function se(t,e,n){const r=t.getContext("2d").getImageData(0,0,t.width,t.height),i=te(t.width,t.height),s=i.getContext("2d");return s.fillStyle="white",s.fillRect(0,0,t.width,t.height),s.putImageData(r,e,n),i}function Ue(t){const n=t.getContext("2d").getImageData(0,0,t.width,t.height),o=[];for(let r=0;r<n.data.length;r+=4)o.push(n.data[r]);return o}function _t(t,e,n,o){let r=o,i=0;for(;i<o;)t.font=`${e} ${r}px ${n}`,i=t.measureText("8").actualBoundingBoxAscent,i<o&&r++;return r}function ke(t){let e;return typeof t=="object"?(e=t[0],typeof e=="object"?[t.length,e.length]:[t.length]):[]}function Se(t,e,n,o){if(n===e.length-1)return o(t);let r;const i=e[n],s=Array(i);for(r=i-1;r>=0;r--)s[r]=Se(t[r],e,n+1,o);return s}function Rt(t){const e=t.length;let n;const o=Array(e);for(n=e-1;n!==-1;--n)o[n]=t[n];return o}function Lt(t){if(typeof t!="object")return t;const e=Rt,n=ke(t);return Se(t,n,0,e)}function Nt(t){let e,n,o;const r=t.length,i=Array(r);let s;for(e=r-1;e>=0;e--){for(s=Array(r),n=e+2,o=r-1;o>=n;o-=2)s[o]=0,s[o-1]=0;for(o>e&&(s[o]=0),s[e]=t[e],o=e-1;o>=1;o-=2)s[o]=0,s[o-1]=0;o===0&&(s[0]=0),i[e]=s}return i}function Ge(t,e,n){typeof n=="undefined"&&(n=0);const o=t[n],r=Array(o);let i;if(n===t.length-1){for(i=o-2;i>=0;i-=2)r[i+1]=e,r[i]=e;return i===-1&&(r[0]=e),r}for(i=o-1;i>=0;i--)r[i]=Ge(t,e,n+1);return r}function Ot(t){return Nt(Ge([t],1))}function Tt(t){const e=ke(t),n=Math.abs,o=e[0],r=e[1],i=Lt(t);let s,c;const a=Ot(o);let p,l,u,f,h,b;for(f=0;f<r;++f){let C=-1,g=-1;for(u=f;u!==o;++u)h=n(i[u][f]),h>g&&(C=u,g=h);for(c=i[C],i[C]=i[f],i[f]=c,l=a[C],a[C]=a[f],a[f]=l,b=c[f],h=f;h!==r;++h)c[h]/=b;for(h=r-1;h!==-1;--h)l[h]/=b;for(u=o-1;u!==-1;--u)if(u!==f){for(s=i[u],p=a[u],b=s[f],h=f+1;h!==r;++h)s[h]-=c[h]*b;for(h=r-1;h>0;--h)p[h]-=l[h]*b,--h,p[h]-=l[h]*b;h===0&&(p[0]-=l[0]*b)}}return a}function Ae(t,e){let n,o,r,i,s,c,a;const p=t.length,l=e.length,u=e[0].length,f=Array(p);for(n=p-1;n>=0;n--){for(i=Array(u),s=t[n],r=u-1;r>=0;r--){for(c=s[l-1]*e[l-1][r],o=l-2;o>=1;o-=2)a=o-1,c+=s[o]*e[o][r]+s[a]*e[a][r];o===0&&(c+=s[0]*e[0][r]),i[r]=c}f[n]=i}return f}function Et(t,e){const n=t.length;let o;const r=Array(n);for(o=n-1;o>=0;o--)r[o]=Dt(t[o],e);return r}function Dt(t,e){let n;const o=t.length;let r,i=t[o-1]*e[o-1];for(n=o-2;n>=1;n-=2)r=n-1,i+=t[n]*e[n]+t[r]*e[r];return n===0&&(i+=t[0]*e[0]),i}function Ie(t){let e,n;const o=t.length,r=t[0].length,i=Array(r);let s,c,a;for(n=0;n<r;n++)i[n]=Array(o);for(e=o-1;e>=1;e-=2){for(c=t[e],s=t[e-1],n=r-1;n>=1;--n)a=i[n],a[e]=c[n],a[e-1]=s[n],--n,a=i[n],a[e]=c[n],a[e-1]=s[n];n===0&&(a=i[0],a[e]=c[0],a[e-1]=s[0])}if(e===0){for(s=t[0],n=r-1;n>=1;--n)i[n][0]=s[n],--n,i[n][0]=s[n];n===0&&(i[0][0]=s[0])}return i}function jt(t){return Math.round(t*1e10)/1e10}function zt(t,e,n){if(n){const g=e;e=t,t=g}const o=[t[0],t[1],1,0,0,0,-1*e[0]*t[0],-1*e[0]*t[1]],r=[0,0,0,t[0],t[1],1,-1*e[1]*t[0],-1*e[1]*t[1]],i=[t[2],t[3],1,0,0,0,-1*e[2]*t[2],-1*e[2]*t[3]],s=[0,0,0,t[2],t[3],1,-1*e[3]*t[2],-1*e[3]*t[3]],c=[t[4],t[5],1,0,0,0,-1*e[4]*t[4],-1*e[4]*t[5]],a=[0,0,0,t[4],t[5],1,-1*e[5]*t[4],-1*e[5]*t[5]],p=[t[6],t[7],1,0,0,0,-1*e[6]*t[6],-1*e[6]*t[7]],l=[0,0,0,t[6],t[7],1,-1*e[7]*t[6],-1*e[7]*t[7]],u=[o,r,i,s,c,a,p,l],f=e;let h;try{h=Tt(Ae(Ie(u),u))}catch{return[1,0,0,0,1,0,0,0]}const b=Ae(h,Ie(u)),C=Et(b,f);for(let g=0;g<C.length;g++)C[g]=jt(C[g]);return C[8]=1,C}function Ft(t,e,n){const[o,r,i,s,c,a,p,l]=t,u=(a-n)/(l*n-c+p*n-s),f=(e*l*u+e-r*u-i)/(o-e*p),h=(i-e)/(p*e-o+l*e-r),b=(n*p*h+n-s*h-a)/(c-n*l);return[f,b]}function Me(t,e=255){const{w:n}=t,o=[-n-1,-n,1-n,-1],r=[],i=new Set;for(const s of t.pixels)if(s.r===e){let c={members:[s],mergeWith(a){const[p,l]=a.members.length>this.members.length?[a,this]:[this,a];for(const u of l.members)p.members.push(u),r[u.i]=p;return i.delete(l),p}};i.add(c),r[s.i]=c;for(const a of o){const p=r[s.i+a];p&&p!==c&&(c=c.mergeWith(p))}}return Array.from(i).map(s=>s.members)}function Vt(t){let e=t[0],n=t[0],o=t[0],r=t[0];for(const i of t)e=e.x*e.y<i.x*i.y?e:i,n=n.rx*n.y<i.rx*i.y?n:i,o=o.x*o.ry<i.x*i.ry?o:i,r=r.rx*r.ry<i.rx*i.ry?r:i;return[e,n,r,o]}function Be(t,e){let n=999999,o=0,r=999999,i=0;for(const s of e)n=Math.min(n,s.x),o=Math.max(o,s.x),r=Math.min(r,s.y),i=Math.max(i,s.y);return[t.pixel(n,r),t.pixel(o,r),t.pixel(o,i),t.pixel(n,i)]}const j=Symbol();var q,J,R,z,Q;const de=class{constructor(e,n,o){L(this,q,void 0);L(this,J,void 0);L(this,R,void 0);L(this,z,void 0);L(this,Q,void 0);w(this,"w");w(this,"h");U(this,q,e),U(this,J,e(n,o)),U(this,R,y(this,J).getContext("2d")),U(this,z,y(this,R).getImageData(0,0,n,o)),this.w=n,this.h=o,U(this,Q,$e(0,this.w*this.h).map(r=>new Wt(this,r)))}get canvas(){return y(this,R).putImageData(y(this,z),0,0),y(this,J)}drawImage(e,n=0,o=0){y(this,R).drawImage(e,n,o),U(this,z,y(this,R).getImageData(0,0,this.w,this.h))}get pixels(){return y(this,Q)}pixel(e,n){return y(this,Q)[n*this.w+e]}get[j](){return y(this,z).data}clone(){const e=new de(y(this,q),this.w,this.h);return e.drawImage(this.canvas),e}crop(e,n){const{x:o,y:r}=e,i=n.x-o+1,s=n.y-r+1,c=new de(y(this,q),i,s);return c.drawImage(this.canvas,-o,-r),c}fill(e){y(this,R).fillStyle=e,y(this,R).fillRect(0,0,this.w,this.h),U(this,z,y(this,R).getImageData(0,0,this.w,this.h))}};let ae=de;q=new WeakMap,J=new WeakMap,R=new WeakMap,z=new WeakMap,Q=new WeakMap;class Wt{constructor(e,n){w(this,"easyCanvas");w(this,"i");this.easyCanvas=e,this.i=n}get x(){return this.i%this.easyCanvas.w}get rx(){return this.easyCanvas.w-this.x}get y(){return Math.floor(this.i/this.easyCanvas.w)}get ry(){return this.easyCanvas.h-this.y}get xy(){return[this.x,this.y]}get r(){return this.easyCanvas[j][this.i*4]}get g(){return this.easyCanvas[j][this.i*4+1]}get b(){return this.easyCanvas[j][this.i*4+2]}setRGB(e){const n=this.easyCanvas[j],o=this.i*4;typeof e=="number"?n[o]=n[o+1]=n[o+2]=e:(n[o]=e[0],n[o+1]=e[1],n[o+2]=e[2])}get rgb(){const e=this.easyCanvas[j],n=this.i*4;return[e[n],e[n+1],e[n+2]]}set a(e){const n=this.easyCanvas[j],o=this.i*4;n[o+3]=e}get a(){const e=this.easyCanvas[j],n=this.i*4;return e[n+3]}}function Ht(t,e,n,o){const r=n-e.w,i=o-e.h,s=new ae(t,n,o);return s.fill("white"),s.drawImage(e.canvas,Math.round(r/2),Math.round(i/2)),s}function _e(t){for(const e of t.pixels){const n=.3*e.r+.3*e.g+.4*e.b;e.setRGB(n)}return t}function Yt(t){for(const e of t.pixels){const n=e.r<126?0:255;e.setRGB(n)}return t}function Kt(t,e){const n=e.map(o=>t.pixels[o]);for(const o of t.pixels)o.a=0;for(const o of n)o.a=255;for(const o of t.pixels)o.a===0&&(o.a=255,o.setRGB(255));return t}function Xt(t){return t<.5?4*t*t*t:1-(-2*t+2)**3/2}function Zt(t){let e=255;for(const o of t.pixels)e=Math.min(e,o.r);const n=255-e;for(const o of t.pixels){const r=o.r-e,i=Xt(1-r/n);o.setRGB(o.r-Math.round(e*i))}return t}function qt(t){const e={};function n(o,r){e[o]=e[o]||[],e[o].push(r)}for(const o of t.pixels)if(o.r<255){const r=t.pixels[o.i-t.w],i=t.pixels[o.i+t.w],s=t.pixels[o.i-1],c=t.pixels[o.i+1];r&&n(r.i,o.r),i&&n(i.i,o.r),s&&n(s.i,o.r),c&&n(c.i,o.r)}for(const o in e){const r=Math.min(...e[o]);t.pixels[o].setRGB(r)}return t}const Jt=10;function Qt(t,e){const n=Math.floor(e/2)*t;return[Math.floor(t*.25)+n,Math.floor(t*.75)+n]}async function Pt(t,e){await e({step:"Preparing image"});const n=t.width,o=t.height,r=new ae(te,n,o);r.fill("white"),r.drawImage(t);const i=r.clone();await e({step:"Applying Filters"}),Yt(_e(i)),await e({step:"Finding Connected Pixels"});const s=Me(i,0);await e({step:"Finding Grid"});const c=$e(...Qt(n,o)),a=s.filter(k=>k.findIndex(T=>c.includes(T.i))!==-1),p=Gt(a),l=s.filter(k=>k.length<Jt).flat().concat(p);for(const k of l)k.setRGB(255);const u=Vt(p),f=Be(i,u),h=u.flatMap(k=>k.xy),b=f.flatMap(k=>k.xy),C=en(h,b);await e({step:"Transforming Grid Perspective"});const g=C(i);qt(g),await e({step:"Finding Digits"});const M=Me(g,0);await e({step:"Transforming Perspective Again"});const B=C(r);await e({step:"Applying Filters Again"}),_e(B),Zt(B),await e({step:"Applying Digit Mask"}),Kt(B,M.flat().map(k=>k.i));const ue=B.w/9,pe=B.h/9;let Y=0,oe=0,we=0;await e({step:"Creating Digit Canvases"});const Ze=M.map(k=>{const T=Be(B,k),re=B.crop(T[0],T[2]),Qe=Math.floor(T[0].y/pe),Pe=Math.floor(T[0].x/ue);Y=Math.max(Y,re.w),oe=Math.max(oe,re.h),we+=re.h;const et=Qe*9+Pe;return S(et,re)});await e({step:"Padding Canvases"});const qe=Math.round(we/M.length),Je=Ze.map(([k,T])=>S(k,Ht(te,T,Y,oe)));return S(Je,Y,oe,qe)}function en(t,e){const n=zt(t,e,!1),o=e[2]-e[0],r=e[5]-e[1],i=e[0],s=e[1];return c=>{const a=new ae(te,o,r);for(const p of a.pixels){const[l,u]=Ft(n,p.x+i,p.y+s),f=c.pixel(Math.round(l),Math.round(u));p.setRGB(f!==void 0?f.rgb:255),p.a=255}return a}}const Re=600;async function tn(t,e){const[n,o,r,i]=await Pt(t,e),s=n.map(p=>p[1].canvas),c=await Bt(o,r,i,s,e),a=Array.from({length:81}).fill(null);return n.forEach(([p],l)=>{a[p]=c[l]}),Promise.resolve(a)}function nn(t){return new Promise(e=>{const n=new Image;n.onload=function(){const o=document.createElement("canvas"),r=Re/n.width;o.width=Re,o.height=n.height*r,o.getContext("2d").drawImage(n,0,0,o.width,o.height),URL.revokeObjectURL(n.src),e(o)},n.src=URL.createObjectURL(t)})}function ce(){return G.exports.createContext(new Proxy({},{get(){throw new Error("Missing Context dependencies")}}))}function Le(){return t=>{const e=t.pipe(it(st)).subscribe(()=>e.unsubscribe());return t}}function on(t,e,n){const o=G.exports.useMemo(()=>new V,n);return G.exports.useEffect(()=>{const r=o.pipe(P(...e)).subscribe(i=>{t(...i)});return()=>r.unsubscribe()},n),r=>()=>o.next(r)}const Ne="RxReactNoValue";function I(t){const e=G.exports.useRef(null);let n=Ne,o=!1;if(e.current!==t&&(e.current=t,o=!0,t.subscribe(s=>n=s).unsubscribe(),n===Ne))throw rt(t);const[r,i]=G.exports.useState(n);return G.exports.useEffect(()=>{const s=t.subscribe(i);return()=>s.unsubscribe()},[t]),o?n:r}class rn{constructor(){w(this,"contents$");w(this,"candidates");this.contents$=new K(null),this.candidates=N.reduce((e,n)=>(e[n]=new K(null),e),{})}}class me{constructor(e){w(this,"occurrences");const n=A(...e.map(o=>o.contents$.pipe(he(r=>r===null?_(S(1,0)):A(_([r,1]),o.contents$.pipe(X(1),xe(1),x(()=>S(r,-1))))))));this.occurrences=N.reduce((o,r)=>Object.assign(o,{[r]:n.pipe(ee((i,[s,c])=>s===r?i+c:i,0))}),{})}}class sn{constructor(e,n,o){w(this,"gridCell");w(this,"contents$");w(this,"candidates");w(this,"isLocked");w(this,"slices");this.gridCell=e,this.slices=n,this.contents$=e.contents$.pipe(E(r=>r===null?_(null):D([_(r),Oe(n,r).pipe(x(i=>Math.max(...i)===1))]))),this.candidates=N.reduce((r,i)=>Object.assign(r,{[i]:e.candidates[i].pipe(E(s=>s===null?_(null):D([_(s),Oe(n,i).pipe(x(c=>Math.max(...c)===0))])))}),{}),this.isLocked=o}toggleContents(e){this.gridCell.contents$.next(this.gridCell.contents$.value===e?null:e)}toggleCandidate(e,n){this.gridCell.contents$.value===null&&this.gridCell.candidates[e].next(this.gridCell.candidates[e].value===n?null:n)}}function Oe(t,e){return D(t.map(n=>n.occurrences[e]))}const an=[0,3,6,27,30,33,54,57,60];class cn{constructor(e=[],n=!0){w(this,"cells");w(this,"isEmpty$");w(this,"isValid$");w(this,"isSolved$");w(this,"updates$");w(this,"gridCells");this.gridCells=Array.from({length:81}).map(()=>new rn),e.forEach((l,u)=>this.gridCells[u].contents$.next(l));const o=N.map(l=>new me(this.gridCells.slice(l*9-9,l*9))),r=N.map(l=>new me(hn(l-1).map(u=>this.gridCells[u]))),i=an.map(l=>new me(gn(l).map(u=>this.gridCells[u])));this.cells=Array.from({length:81}).map((l,u)=>new sn(this.gridCells[u],[o[dn(u)],r[pn(u)],i[fn(u)]],!!e[u]&&n)),this.updates$=A(...this.gridCells.map((l,u)=>A(l.contents$.pipe(X(1),x(f=>({type:"CellUpdate",cellIndex:u,contents:f}))),...N.map(f=>l.candidates[f].pipe(X(1),x(h=>({type:"CandidateUpdate",cellIndex:u,candidate:f,color:h})))))));const s=this.gridCells.map(l=>l.contents$.pipe(he(u=>u===null?_(0):A(_(1),l.contents$.pipe(X(1),xe(1),x(()=>-1)))))),c=A(...s).pipe(ee((l,u)=>l+u,0)),a=n?e.filter(l=>!!l).length:0;this.isEmpty$=c.pipe(x(l=>l===a));const p=A(...[...o,...r,...i].flatMap(l=>N.map(u=>l.occurrences[u].pipe(Z(0),fe(),at())))).pipe(ee((l,[u,f])=>f>u&&f>1?l+1:f<u&&f>0?l-1:l,0),fe(),Z(0));this.isValid$=p.pipe(x(l=>l===0)),this.isSolved$=D([c,this.isValid$]).pipe(x(([l,u])=>l===81&&u))}getContents(e=!1){return this.gridCells.map((n,o)=>{const r=this.cells[o].isLocked;return!e||r?n.contents$.value:null})}}function ln(t){return Math.floor(t/9)*9}function dn(t){return Math.floor(ln(t)/9)}function un(t){return t%9}function pn(t){return un(t)}function hn(t){const e=t%9;return Array.from({length:9}).map((n,o)=>e+o*9)}function Te(t){return Math.floor(t/27)*27+t%9-t%3}function fn(t){const e=Te(t);return e<9?Math.floor(e/3):e<36?Math.floor(3+(e-27)/3):Math.floor(6+(e-54)/3)}function gn(t){const e=Te(t);return[e,e+1,e+2,e+9,e+10,e+11,e+18,e+19,e+20]}const N=[1,2,3,4,5,6,7,8,9],be=["a","b","c"];function ne(t,e){return new cn(t,e)}var F;class mn{constructor(){w(this,"game$");L(this,F,void 0);w(this,"status$");w(this,"canStart$");w(this,"canReset$");w(this,"updates$");this.game$=new K(ne());const e=this.game$.pipe(E(n=>n.isSolved$));U(this,F,new K(v.Creating)),this.status$=y(this,F).pipe(P(e),x(([n,o])=>o?v.Solved:n),ie(1)),this.canStart$=this.game$.pipe(E(n=>D([n.isEmpty$,n.isValid$])),x(([n,o])=>!n&&o)),this.canReset$=this.game$.pipe(E(n=>D([n.isEmpty$,n.isSolved$])),x(([n,o])=>!n&&!o)),this.updates$=new V}startGame(){const e=this.game$.value.getContents();this.game$.next(ne(e)),y(this,F).next(v.Solving),this.updates$.next({type:"StartGameUpdate"})}newGame(){this.game$.next(ne()),y(this,F).next(v.Creating),this.updates$.next({type:"NewGameUpdate"})}resetGame(){const e=this.game$.value.getContents().map((n,o)=>this.game$.value.cells[o].isLocked?n:null);this.game$.next(ne(e)),this.updates$.next({type:"ResetGameUpdate"})}loadGame(e,n=!0){this.game$.next(ne(e,n)),n&&y(this,F).next(v.Solving),this.updates$.next({type:"LoadGameUpdate",contents:e,startGame:n})}}F=new WeakMap;var v;(function(t){t[t.Creating=0]="Creating",t[t.Solving=1]="Solving",t[t.Solved=2]="Solved"})(v||(v={}));function bn(){return new mn}const d=ge.exports.jsx,m=ge.exports.jsxs,$=ge.exports.Fragment,Ee=ce();function yn(){const{app:t,share:e,saveLoadUndo:n,gridFromImage:o}=G.exports.useContext(Ee),r=I(t.status$),i=I(t.canStart$),s=I(t.canReset$),c=I(t.game$),a=r===v.Creating,p=r!==v.Creating&&!s,l=r!==v.Creating&&s,u=r!==v.Creating;function f(h){const b=h.target.files?h.target.files[0]:null;b&&nn(b).then(o)}return m("div",{className:"ButtonBar",children:[d("button",{onClick:()=>n.undo(),children:d(ct,{})}),a&&d("button",{disabled:!i,onClick:()=>t.startGame(),"data-testid":"button-bar-start",children:d(lt,{})}),p&&d("button",{onClick:()=>t.newGame(),"data-testid":"button-bar-new",children:d(dt,{})}),l&&d("button",{onClick:()=>t.resetGame(),"data-testid":"button-bar-reset",children:d(ut,{})}),!u&&m($,{children:[d("input",{hidden:!0,type:"file",accept:"image/*",onChange:f}),d("button",{onClick:h=>h.currentTarget.previousSibling.click(),children:d(pt,{})})]}),u&&d("button",{onClick:()=>e(c),"data-testid":"button-bar-share",children:d(ht,{})}),d("button",{onClick:()=>n.redo(),children:d(ft,{})})]})}function wn(t,e,n){return function(r){return tn(r,i=>new Promise(s=>{e.next({body:d("p",{children:i.step}),onRender:s})})).then(i=>{n.next(),t.loadGame(i,!1)})}}const De=ce();function Cn(){var r,i;const{message$:t,dismiss$:e}=G.exports.useContext(De),n=I(t);G.exports.useEffect(()=>{n&&n.onRender&&n.onRender()},[n]);const o=n&&n.arrow&&n.arrow.target==="ButtonBar"?{"--arrow-button":n.arrow.button,"--arrow-other-button":n.arrow.otherButton}:void 0;return d("div",{className:`Messages ${n?"-ShowingMessage":""}`,onClick:()=>e.next(),"data-testid":"messages",children:n&&d("div",{className:`--Message ${n.arrow?"-Indicating":""}`,"data-arrow-target":n.arrow&&n.arrow.target,style:o,"data-arrow-other-button":((r=n==null?void 0:n.arrow)==null?void 0:r.target)==="ButtonBar"?(i=n==null?void 0:n.arrow)==null?void 0:i.otherButton:void 0,"data-testid":"messages-message",children:n.body})})}function xn(){const t=new V,e=new V,n=t.pipe(x(o=>$n({a:o,b$:o.mustDismiss?e:A(e,vn(t)),c:void 0})),wt(),Z(void 0),ie(1),Le());return{messages$:t,message$:n,dismiss$:e}}function vn(t){return t.pipe(gt(),ie(1),Le())}function $n({a:t,b$:e,c:n}){return mt(bt.pipe(Z(t),yt(e)),_(n))}const Un=Object.fromEntries(be.map((t,e)=>[t,be[(e+1)%be.length]])),je=ce();function kn(){const{selectedNumber$:t,currentColor$:e}=G.exports.useContext(je),n=I(t),o=I(e),r=i=>{t.value===i?e.next(Un[e.value]):t.next(i)};return m("div",{className:"NumberPicker","data-current-color":o,children:[d("div",{style:{"--selected":n},className:"--Selection","data-testid":"number-picker-selection"}),d("ul",{className:"--Values",children:N.map(i=>d("li",{onClick:()=>r(i),style:{"--value":i},children:i},i))})]})}function Sn(t){let e=BigInt(t).toString(16);e.length%2&&(e="0"+e);const n=[];let o=0,r,i;for(;o<e.length;)r=parseInt(e.slice(o,o+2),16),i=String.fromCharCode(r),n.push(i),o+=2;return btoa(n.join(""))}function Gn(t){const e=atob(t),n=[];return e.split("").forEach(function(o){let r=o.charCodeAt(0).toString(16);r.length%2&&(r="0"+r),n.push(r)}),BigInt("0x"+n.join(""))}function An(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function In(t){const e=t.length%4;return e===2?t+="==":e===3&&(t+="="),t.replace(/-/g,"+").replace(/_/g,"/")}const ze=[["000000000","_9"],["00000000","_8"],["0000000","_7"],["000000","_6"],["00000","_5"],["0000","_4"],["000","_3"],["00","_2"],["0","_1"],["_","0"]],Mn=[...ze].reverse();function Bn(t){const e=t.map(r=>r===null?0:r).join(""),n=BigInt(e).toString(),o=ze.reduce((r,[i,s])=>r.replaceAll(i,s),n);return An(Sn(o))}function _n(t){const e=Gn(In(t)).toString();return Mn.reduce((r,[i,s])=>r.replaceAll(s,i),e).padStart(81,"0").split("").map(r=>r==="0"?null:parseInt(r,10))}var ye;(function(t){t[t.Mobile=0]="Mobile",t[t.Clipboard=1]="Clipboard"})(ye||(ye={}));function Rn(t){if(window.location.hash){const e=_n(window.location.hash.substring(1));t.loadGame(e,!0),history.replaceState(null,"",".")}}function Ln(t){const e=new URL(window.location.href);return e.hash=Bn(t.getContents(!0)),typeof navigator.share=="function"?(navigator.share({url:e.toString()}),0):(navigator.clipboard.writeText(e.toString()),1)}function Nn(t){return function(n){Ln(n)===ye.Clipboard&&t.next({body:d("p",{children:"Copied Link To Clipboard."})})}}const Fe=ce();var Ve;(function(t){t[t.Click=0]="Click",t[t.DblClick=1]="DblClick"})(Ve||(Ve={}));function On(){const{selectedNumber$:t,currentColor$:e,app:n,undoBuffer:o}=G.exports.useContext(Fe),r=I(n.game$),i=G.exports.useMemo(()=>r.cells.map(s=>({highlightCell$:D([s.contents$,t]).pipe(x(([c,a])=>!!c&&c[0]===a)),highlightCandidate:N.reduce((c,a)=>Object.assign(c,{[a]:D([s.candidates[a],t]).pipe(x(([p,l])=>p!==null&&a===l))}),{})})),[r.cells]);return d("div",{className:"SudokuGrid","data-testid":"sudoku-grid",children:r.cells.map((s,c)=>d(Tn,{cell:s,selectedNumber$:t,currentColor$:e,app:n,highlights:i[c],undoBuffer:o},c))})}function Tn({cell:t,selectedNumber$:e,currentColor$:n,app:o,highlights:r,undoBuffer:i}){const[s,c]=I(t.contents$)||[null,!0],a=I(r.highlightCell$),p=on((l,u,f,h)=>{l===0?i.clear():i.flush(),!t.isLocked&&(h===v.Creating&&l===0||h===v.Solving&&l===1?t.toggleContents(u):h===v.Solving&&l===0&&t.toggleCandidate(u,f))},[e,n,o.status$],[t,t.isLocked]);return m("div",{className:`--Cell ${t.isLocked?"-Locked":""} ${a?"-Highlight":""} ${s?`-ShowingContents ${c?"-Valid":"-Invalid"}`:"-ShowingCandidates"}`,onClick:Dn(p(0)),onDoubleClick:p(1),children:[d("div",{className:"--Candidates",children:N.map(l=>d(En,{candidate:l,status$:t.candidates[l],isHighlighted$:r.highlightCandidate[l]},l))}),d("div",{className:"--Contents",children:s})]})}function En({candidate:t,status$:e,isHighlighted$:n}){const o=I(e),r=I(n);return d("div",{className:`--Candidate ${r?"-Highlight":""} ${o!==null?o[1]?"-Valid":"-Invalid":""}`,"data-candidate-color":o==null?void 0:o[0],children:o!==null?t:" "})}function Dn(t){return e=>{e.detail===1&&t()}}function jn({context:t,children:e}){const{selectedNumber$:n,currentColor$:o,app:r,saveLoadUndo:i,undoBuffer:s,message$:c,messages$:a,dismiss$:p}=t,l=Nn(a),u=wn(r,a,p);return d(De.Provider,{value:{message$:c,dismiss$:p},children:d(Fe.Provider,{value:{selectedNumber$:n,currentColor$:o,app:r,undoBuffer:s},children:d(je.Provider,{value:{selectedNumber$:n,currentColor$:o},children:d(Ee.Provider,{value:{app:r,share:l,saveLoadUndo:i,gridFromImage:u},children:e})})})})}function zn(t){return A(t.updates$.pipe(x(e=>({type:"AppUpdate",detail:e}))),t.game$.pipe(E(e=>e.updates$),x(e=>({type:"GridUpdate",detail:e}))))}function Fn(t){const e=[...t].reverse(),n=e.findIndex(r=>r.type==="AppUpdate"&&r.detail.type==="NewGameUpdate");if(n!==-1)return e.slice(0,n).reverse();const o=e.findIndex(r=>r.type==="AppUpdate"&&r.detail.type==="LoadGameUpdate");return o!==-1?e.slice(0,o+1).reverse():t}function We(t,e){_(...e).pipe(P(t.game$)).subscribe(([n,o])=>{He(t,o,n)})}function He(t,e,n){switch(n.type){case"AppUpdate":Vn(t,n.detail);break;case"GridUpdate":Wn(e,n.detail);break;default:console.error("Unhandled replayUpdate",(o=>o)(n))}}function Vn(t,e){switch(e.type){case"LoadGameUpdate":t.loadGame(e.contents,e.startGame);break;case"NewGameUpdate":t.newGame();break;case"ResetGameUpdate":t.resetGame();break;case"StartGameUpdate":t.startGame();break;default:console.error("Unhandled replayAppUpdate",(n=>n)(e))}}function Wn(t,e){switch(e.type){case"CellUpdate":t.cells[e.cellIndex].toggleContents(e.contents);break;case"CandidateUpdate":t.cells[e.cellIndex].toggleCandidate(e.candidate,e.color);break;default:console.error("Unhandled replayGridUpdate",(n=>n)(e))}}function Hn(t,e,n,o){switch(o.type){case"AppUpdate":Yn(t,n);break;case"GridUpdate":Kn(e,n,o.detail);break;default:console.error("Unhandled rollbackUpdate",(r=>r)(o))}}function Yn(t,e){const n=[...e].reverse(),o=n.findIndex(s=>s.type==="AppUpdate"&&["NewGameUpdate","LoadGameUpdate"].includes(s.detail.type)),r=o===-1?n.length:o+1,i=n.slice(0,r).reverse();o===-1&&t.newGame(),We(t,i)}function Kn(t,e,n){switch(n.type){case"CellUpdate":Xn(t,e,n.cellIndex);break;case"CandidateUpdate":qn(t,e,n.cellIndex,n.candidate);break;default:console.error("Unhandled replayGridUpdate",(o=>o)(n))}}function Xn(t,e,n){const o=[...e].reverse(),r=o.findIndex(c=>c.type==="AppUpdate"||Zn(c,n)),i=o[r];let s=null;i&&i.type==="GridUpdate"&&i.detail.type==="CellUpdate"?s=i.detail.contents:i&&i.type==="AppUpdate"&&i.detail.type==="LoadGameUpdate"&&(s=i.detail.contents[n]),t.cells[n].toggleContents(s)}function Zn(t,e){return t.type==="GridUpdate"&&t.detail.type==="CellUpdate"&&t.detail.cellIndex===e}function qn(t,e,n,o){const r=[...e].reverse(),i=r.findIndex(a=>a.type==="AppUpdate"||Jn(a,n,o)),s=r[i];let c=null;s&&s.type==="GridUpdate"&&s.detail.type==="CandidateUpdate"&&(c=s.detail.color),t.cells[n].toggleCandidate(o,c)}function Jn(t,e,n){return t.type==="GridUpdate"&&t.detail.type==="CandidateUpdate"&&t.detail.cellIndex===e&&t.detail.candidate===n}var W;class Qn{constructor(e,n){L(this,W,void 0);U(this,W,new V);const o=n.pipe(x(()=>"increment"));A(y(this,W),o).pipe(ee(([i],s)=>{switch(s){case"flush":return S(0,i);case"increment":return S(i+1,0);case"clear":return S(0,0)}},S(0,0))).subscribe(([,i])=>{for(let s=0;s<i;s++)e.undo()})}flush(){y(this,W).next("flush")}clear(){y(this,W).next("clear")}}W=new WeakMap;var H,O;class Pn{constructor(e,n){L(this,H,void 0);L(this,O,void 0);w(this,"collection$");w(this,"updates$");U(this,H,new V),U(this,O,!1);const o=e.pipe(Ct(()=>!y(this,O))),r=A(o,y(this,H)).pipe(ee((i,s)=>{if(s==="SaveLoadUndoAction_Undo"){const[[c,a]]=i,p=c.pop();return p===void 0?i:(a.push(p),[[c,a],s,p])}else if(s==="SaveLoadUndoAction_Redo"){const[[c,a]]=i,p=a.pop();return p===void 0?i:(c.push(p),[[c,a],s,p])}else{const[[c]]=i;return[[c.concat(s),[]],null,null]}},[n,null,null]),Z([n,null,null]),fe(),ie(1));this.collection$=r.pipe(X(1),x(i=>i[0])),this.updates$=r.pipe(X(1),he(([[i],s,c])=>s!==null&&c!==null?_({type:s==="SaveLoadUndoAction_Undo"?"Undo":"Redo",affected:c,history:i}):xt))}undo(){U(this,O,!0),y(this,H).next("SaveLoadUndoAction_Undo"),U(this,O,!1)}redo(){U(this,O,!0),y(this,H).next("SaveLoadUndoAction_Redo"),U(this,O,!1)}}H=new WeakMap,O=new WeakMap;var Ye;(function(t){t[t.One=0]="One"})(Ye||(Ye={}));const Ke=0;function eo(t,e){const n=t.get(),o=n&&n.version===Ke?n.data:[[],[]],r=new V,i=Fn(o[0]),s=new Pn(r,[i,o[1]]),c=zn(e);return[{undo(){s.undo()},redo(){s.redo()},setup(){We(e,i),c.subscribe(r),s.collection$.subscribe(a=>{t.set({version:Ke,data:a})}),s.updates$.pipe(P(e.game$)).subscribe(([a,p])=>{a.type==="Undo"?Hn(e,p,a.history,a.affected):He(e,p,a.affected)})}},c]}function to(t,e){return new Qn(t,e)}function no(){const t=new K(1),e=new K("a"),n=bn(),o=ve("SaveLoadUndo"),r=ve("Onboarding"),[i,s]=eo(o,n),c=to(i,s),{messages$:a,message$:p,dismiss$:l}=xn();return{selectedNumber$:t,currentColor$:e,app:n,saveLoadUndoStorage:o,saveLoadUndo:i,undoBuffer:c,onboardingStorage:r,messages$:a,message$:p,dismiss$:l}}function le(){return window.matchMedia("(hover: none)").matches}function oo(t,e,n){var f;const o=((f=t.get())==null?void 0:f.seen)||{};function r(h,b,C){o[h]||e.next({body:b,mustDismiss:!0,arrow:C,onRender:()=>{o[h]=!0,t.set({seen:o})}})}const i=n.game$.pipe(E(h=>h.updates$),x(h=>({type:"GameUpdate",detail:h}))),s=n.game$.pipe(E(h=>h.isValid$)),c=n.updates$.pipe(x(h=>({type:"AppUpdate",detail:h}))),a=d("i",{children:le()?"Tap":"Click"}),p=d("i",{children:le()?"Double Tap":"Double Click"}),l=d("i",{children:le()?"Tapping":"Clicking"}),u=le()?"phone or tablet":"computer";r("welcome",m($,{children:[d("p",{children:"Welcome to my Sudoku app."}),d("p",{children:"I'll be sharing a few details the first time you encounter things."}),m("p",{children:[a," anywhere to dismiss a message."]})]})),r("about",m($,{children:[d("p",{children:"The app has no puzzles of its own."}),d("p",{children:"Instead you can use it to play puzzles from newspapers, sudoku books or other websites."})]})),A(c,i).pipe(Z({type:"InitialUpdate"}),vt(0),P(n.status$,s)).subscribe(([h,b,C])=>{let g,M;h.type==="AppUpdate"?g=h.detail:h.type==="GameUpdate"&&(M=h.detail),b===v.Creating&&(r("create_start",m($,{children:[m("p",{children:["Right now you're in ",d("b",{children:"Create Mode"}),"."]}),d("p",{children:"Here you can add a puzzle to play and share."})]})),r("photo_import",m($,{children:[m("p",{children:["The easiest way is by ",d("b",{children:"Photo Import"}),"."]}),d("p",{children:"You can take a photo or choose an image of a Sudoku Grid."}),d("p",{children:"The entire grid must be in the photo or stange things might happen.."})]})),r("photo_import_button",m("p",{children:[a," the camera icon to use it."]}),{target:"ButtonBar",button:2}),r("create_manual",d("p",{children:"Otherwise you can edit the grid manually."})),r("create_choose_number",m("p",{children:["Start by ",l," a number to select it."]}),{target:"NumberPicker"}),r("create_toggle_cell",m("p",{children:["Then ",a," a cell to add or remove that number."]}),{target:"SudokuGrid"})),g&&g.type==="LoadGameUpdate"&&g.startGame===!1&&(r("photo_import_complete",d($,{children:m("p",{children:["Your ",u," has just trained a simple AI to understand the photo in real time."]})})),C?(r("photo_import_promising",d($,{children:d("p",{children:"It does looks promising but it's best to check it over."})})),r("photo_import_take_again",d($,{children:d("p",{children:"If it's miles off you can try taking the photo again."})}))):r("photo_import_take_again",d($,{children:d("p",{children:"It seems you have some errors. Maybe try taking the photo again."})})),r("photo_import_errors_advice",m($,{children:[d("p",{children:"For best results keep the grid straight and centered."}),d("p",{children:"If it's from a screen, try zooming in and taking the photo from further away."})]})),r("photo_import_errors_fix",d("p",{children:"Sometimes it's quicker to correct a few numbers manually."}))),(C&&g&&g.type==="LoadGameUpdate"&&g.startGame===!1||C&&M!==void 0&&b===v.Creating)&&r("start_game_button",m("p",{children:["This is the ",d("b",{children:"Start Game Button"})," for when you are done creating."]}),{target:"ButtonBar",button:1}),M!==void 0&&r("undo_redo",m($,{children:[m("p",{children:["The ",d("b",{children:"Undo and Redo Buttons"})," are available to correct errors."]}),d("p",{children:"They even work if you start or clear the game."})]}),{target:"ButtonBar",button:0,otherButton:3}),g&&g.type==="LoadGameUpdate"&&g.startGame===!0&&r("arrive_from_link",d("p",{children:"You've arrived from a shared puzzle link so you can start solving right away."})),g&&g.type==="StartGameUpdate"&&r("start_game",m("p",{children:["The puzzle cells are now locked and you're in ",d("b",{children:"Solve Mode"}),"."]})),b===v.Solving&&(r("solving_choose_number",m("p",{children:["Start by ",l," a number to select it."]}),{target:"NumberPicker"}),r("solving_toggle_cell_solution",d($,{children:m("p",{children:[p," to add or remove the chosen number as a Solution."]})}),{target:"SudokuGrid"}),r("solving_toggle_cell_candidate",d($,{children:m("p",{children:[a," a cell to add or remove the chosen number as a Candidate."]})}),{target:"SudokuGrid"}),r("solving_candidate_colouring",d($,{children:d("p",{children:"Advanced Feature: Tap the selected number to cycle through candidate colours."})}),{target:"NumberPicker"})),M!==void 0&&M.type==="CellUpdate"&&b===v.Solving&&(r("reset_button",m($,{children:[m("p",{children:["The ",d("b",{children:"Reset Button"})," will start the puzzle again."]}),m("p",{children:[a," it twice to go back to Create Mode."]}),d("p",{children:"These actions can be undone."})]}),{target:"ButtonBar",button:1}),r("save_progress",m($,{children:[d("p",{children:"Your progress is being saved so you can continue later if you need to."}),d("p",{children:"You can even play when you are offline."})]})),r("share_button",m($,{children:[m("p",{children:[a," the ",d("b",{children:"Share Button"})," any time to share puzzles with friends."]}),d("p",{children:"Shared puzzles won't include any of your current progress."}),d("p",{children:"I'll leave you in peace now. Enjoy!"})]}),{target:"ButtonBar",button:2})),b===v.Solved&&(r("complete",m($,{children:[d("p",{children:"All done. I hope this first puzzle was a smooth experience."}),m("p",{children:["The ",d("b",{children:"Bin Button"})," will clear the grid and return to Create Mode."]})]}),{target:"ButtonBar",button:1}),r("final_share",m("p",{children:["Maybe you want to ",d("b",{children:"Share"})," the puzzle before you do that?"]}),{target:"ButtonBar",button:2}))})}let Xe={enable(){}};navigator.userAgent.includes("jsdom")||(Xe=new $t);function ro(){const t=no(),{saveLoadUndo:e,onboardingStorage:n,messages$:o,app:r}=t;G.exports.useEffect(()=>{e.setup(),oo(n,o,r),Rn(r)},[]);function i(){Xe.enable()}return d(jn,{context:t,children:m("div",{className:"SudokuApp",onClick:i,children:[d(Cn,{}),d(On,{}),d(kn,{}),d(yn,{})]})})}function io(t={}){const{immediate:e=!1,onNeedRefresh:n,onOfflineReady:o,onRegistered:r,onRegisterError:i}=t;let s;const c=async(a=!0)=>{};return"serviceWorker"in navigator&&(s=new Ut("/sudoku/sw.js",{scope:"/sudoku/",type:"classic"}),s.addEventListener("activated",a=>{a.isUpdate?window.location.reload():o==null||o()}),s.register({immediate:e}).then(a=>{r==null||r(a)}).catch(a=>{i==null||i(a)})),c}io();kt.exports.render(d(ro,{}),document.getElementById("root"));
